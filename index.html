<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Using R</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="In this blog I share some things about using the R programming language to analyze and visualize data. I use R in my daily work and life. If you want to run the code I share, you may want to install R">
<meta property="og:type" content="website">
<meta property="og:title" content="Using R">
<meta property="og:url" content="http://petarmimica.github.io/index.html">
<meta property="og:site_name" content="Using R">
<meta property="og:description" content="In this blog I share some things about using the R programming language to analyze and visualize data. I use R in my daily work and life. If you want to run the code I share, you may want to install R">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Using R">
<meta name="twitter:description" content="In this blog I share some things about using the R programming language to analyze and visualize data. I use R in my daily work and life. If you want to run the code I share, you may want to install R">
  
    <link rel="alternate" href="/atom.xml" title="Using R" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Using R</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">(for data analysis and visualization)</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://petarmimica.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-A-simple-status-progress-bar-with-time-estimator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/26/A-simple-status-progress-bar-with-time-estimator/" class="article-date">
  <time datetime="2017-10-26T10:49:00.000Z" itemprop="datePublished">2017-10-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/26/A-simple-status-progress-bar-with-time-estimator/">A simple status/progress bar with time estimator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently I had to perform some heavy post-processing of the results of a<br>simulation I am performing. One of the things I had to do was create<br>complex plots of different variables. Since I needed to have some idea<br>about when the job would finish, I decided to port a Fortran module I<br>have been using for several years to do just that. The result is an<br>animated (in console/terminal, at least) status bar in R which looks<br>something like this:</p>
<p><code>======&gt;                                                     | Processing snapshot: 00081 (12%) ETA: 2017-10-25 16:07:00</code></p>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><p>A few years ago I was leading <a href="https://arxiv.org/abs/1501.00361" target="_blank" rel="external">a complex<br>project</a> trying to <a href="https://arxiv.org/abs/1603.05832" target="_blank" rel="external">explain the<br>astrophysical source Swift J1644</a> and<br>also participated heavily in a project attempting to understand the <a href="https://arxiv.org/abs/1605.08437" target="_blank" rel="external">the<br>broader consequences</a> of our<br>conclusions about Swift J1644.</p>
<p>One of the technical challenges is that I had to perform a large number<br>of simulations on a machine shared with other users. The simulations<br>were performed in parallel and their performance depended heavily on<br>what the other users were and were not doing. Still, I wanted to have<br>some inkling about when each simulation was supposed to finish.</p>
<p>Since the code was written in Fortran, I started writing a module to<br>take care of that task. First, I had to write a module that properly<br>dealt with system time. You can download that module from<br><a href="https://github.com/petarmimica/timers_f" target="_blank" rel="external">https://github.com/petarmimica/timers_f</a>. Fortunately, all this is<br>nicely dealt with in R with built-in routines and <code>lubridate</code> package.<br>Next, I wrote a module that has to offer the following functionality:</p>
<ol>
<li>allow the user to log the progress of some task</li>
<li>estimate the time of completion</li>
<li>return the predictions in a nice format</li>
</ol>
<p>Clearly, the last item is easily dealt with using the <code>timers_f</code>, but<br>the first two had to be implemented. In my implementation a data type is<br>defined that contains several vectors. One of the vectors are all logged<br>times, and another vector contains the corresponding fraction of work<br>done. This data is then fed to a few estimator routines that construct a<br>model to try to predict at what time the job would reach some level of<br>completion. Whenever a new entry was added by the user, the estimators<br>would predict the time at which that particular value of job completion<br>should have been reached using the previous data. Then each algorithm<br>could be graded by some method (I chose a sum of squares of deviations<br>for all data points, but one can use many other metrics). Then each<br>estimator would make the prediction for when the job completion would<br>reach 100%, and then the final prediction would be computed by using a<br>weighted average of all estimators.</p>
<p>I experimented with several estimators, but in the end I settled on four<br>(in reality two, but with varying parameters): * a linear fit of all<br>measurements * a linear fit of (at most) the last five measurements *<br>a linear prediction using only the last measurement * a quadratic<br>prediction using only the last measurement</p>
<p>Although I am using two different codes (a CFD simulation and a<br>relativistic raytracing code), and although I am using them on different<br>machines, performing both parallel and sequential calculations and using<br>both shared and distribured memories, the combination of these four<br>estimators always gave satisfactory results. That is why I decided to<br>implement this in R.</p>
<h2 id="Introducing-estatusbar"><a href="#Introducing-estatusbar" class="headerlink" title="Introducing estatusbar"></a>Introducing estatusbar</h2><p>The package that implements the abovementioned functionality can be<br>found here: <a href="https://github.com/petarmimica/estatusbar" target="_blank" rel="external">https://github.com/petarmimica/estatusbar</a>. We can easily<br>test it. Assume that we are going to log the time after each 10% of the<br>task has been completed, but the time between each entry is a random<br>number between 0 and 5 seconds (uniform distribution).</p>
<pre><code>est &lt;- estatusbar$new()
for (i in 1:10) {
  Sys.sleep(5 * runif(1))
  est$add(i / 10)
  est$display()
}

## 

|===&gt;                                    | (10%) ETA: 2017-10-26 12:42:17

|=======&gt;                                | (20%) ETA: 2017-10-26 12:42:44

|===========&gt;                            | (30%) ETA: 2017-10-26 12:42:59

|===============&gt;                        | (40%) ETA: 2017-10-26 12:42:32

|===================&gt;                    | (50%) ETA: 2017-10-26 12:42:50

|=======================&gt;                | (60%) ETA: 2017-10-26 12:43:17

|===========================&gt;            | (70%) ETA: 2017-10-26 12:42:44

|===============================&gt;        | (80%) ETA: 2017-10-26 12:42:47

|===================================&gt;    | (90%) ETA: 2017-10-26 12:42:54

|=======================================&gt;| (100%) ETA: 2017-10-26 12:42:51

Sys.time()

## [1] &quot;2017-10-26 12:42:51 CEST&quot;
</code></pre><p>I printed the system time after the task has been completed. This is a<br>pretty adverse test, but it seems that the routine was able to handle it<br>and the estimated final time of completion was close to the final one<br>after 50% of the task has been completed.</p>
<h2 id="Testing-the-estimators"><a href="#Testing-the-estimators" class="headerlink" title="Testing the estimators"></a>Testing the estimators</h2><p>Let’s test the estimators for different kinds of tasks. We will generate<br>the test data so that there are 20 entries, but the fractions are spaced<br>randomly. Then we will use different models for the execution time.</p>
<p>The intervals are generated:</p>
<pre><code>intervals &lt;- runif(20)
intervals &lt;- intervals / sum(intervals) # normalize
cintervals &lt;- cumsum(intervals)
</code></pre><h2 id="Constant-time"><a href="#Constant-time" class="headerlink" title="Constant time"></a>Constant time</h2><p>In this test we assume that the time increases linearly with the<br>fraction of work done. Let’s assume that the total time it takes for the<br>task to finish is 60 seconds.</p>
<pre><code>times.lin &lt;- intervals
times.lin &lt;- 60 * times.lin / sum(times.lin)
</code></pre><p>We can now test the estimators:</p>
<pre><code>Sys.time() # start

## [1] &quot;2017-10-26 12:42:51 CEST&quot;

est.lin &lt;- estatusbar$new()
for (i in 1:length(intervals)) {
  Sys.sleep(times.lin[i])
  est.lin$add(cintervals[i])
  est.lin$display()
}

## 

|&gt;                                        | (02%) ETA: 2017-10-26 12:42:51

|==&gt;                                     | (08%) ETA: 2017-10-26 12:43:51

|=====&gt;                                  | (16%) ETA: 2017-10-26 12:43:51

|========&gt;                               | (23%) ETA: 2017-10-26 12:43:51

|========&gt;                               | (24%) ETA: 2017-10-26 12:43:51

|===========&gt;                            | (30%) ETA: 2017-10-26 12:43:51

|===========&gt;                            | (31%) ETA: 2017-10-26 12:43:51

|=============&gt;                          | (37%) ETA: 2017-10-26 12:43:51

|===============&gt;                        | (40%) ETA: 2017-10-26 12:43:51

|==================&gt;                     | (47%) ETA: 2017-10-26 12:43:51

|=====================&gt;                  | (55%) ETA: 2017-10-26 12:43:52

|======================&gt;                 | (58%) ETA: 2017-10-26 12:43:51

|=========================&gt;              | (66%) ETA: 2017-10-26 12:43:50

|============================&gt;           | (74%) ETA: 2017-10-26 12:43:51

|===============================&gt;        | (80%) ETA: 2017-10-26 12:43:51

|===============================&gt;        | (81%) ETA: 2017-10-26 12:43:51

|=================================&gt;      | (86%) ETA: 2017-10-26 12:43:51

|====================================&gt;   | (93%) ETA: 2017-10-26 12:43:51

|======================================&gt; | (99%) ETA: 2017-10-26 12:43:51

|=======================================&gt;| (100%) ETA: 2017-10-26 12:43:51

Sys.time()

## [1] &quot;2017-10-26 12:43:51 CEST&quot;
</code></pre><p>It seems that after the first two entries the linear estimators dominate<br>and predict correctly the completion time despite the irregular nature<br>of the subsequent data. Let’s look into this in a bit more detail, by<br>plotting the estmates for the final time as entries are addped.<br><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-7-1.png" alt=""> As can be<br>seen, all linear models perform perfectly, while the quadratic one does<br>not (as expected). Let’s look at the linear models only:<br><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-8-1.png" alt=""> ##<br>Quadratic time</p>
<p>In this test we assume that the time increases quadratically with the<br>fraction of work done.</p>
<pre><code>intervals &lt;- runif(20)
intervals &lt;- intervals / sum(intervals) # normalize
cintervals &lt;- cumsum(intervals)
ctimes.sq &lt;- cintervals^2
times.sq &lt;- ctimes.sq
times.sq[2:length(times.sq)] &lt;- times.sq[2:length(times.sq)] - times.sq[1:(length(times.sq)-1)]
times.sq &lt;- 60 * times.sq / sum(times.sq)

Sys.time() # start

## [1] &quot;2017-10-26 12:43:53 CEST&quot;

est.sq &lt;- estatusbar$new()
for (i in 1:length(intervals)) {
  Sys.sleep(times.sq[i])
  est.sq$add(cintervals[i])
  est.sq$display()
}

## 

|==&gt;                                     | (09%) ETA: 2017-10-26 12:43:53

|==&gt;                                     | (09%) ETA: 2017-10-26 12:43:59

|====&gt;                                   | (14%) ETA: 2017-10-26 12:46:03

|======&gt;                                 | (18%) ETA: 2017-10-26 12:44:54

|=========&gt;                              | (25%) ETA: 2017-10-26 12:44:55

|============&gt;                           | (33%) ETA: 2017-10-26 12:44:53

|==============&gt;                         | (38%) ETA: 2017-10-26 12:44:53

|===============&gt;                        | (41%) ETA: 2017-10-26 12:44:54

|=================&gt;                      | (45%) ETA: 2017-10-26 12:44:54

|==================&gt;                     | (47%) ETA: 2017-10-26 12:44:54

|=====================&gt;                  | (55%) ETA: 2017-10-26 12:44:54

|=======================&gt;                | (61%) ETA: 2017-10-26 12:44:53

|========================&gt;               | (64%) ETA: 2017-10-26 12:44:53

|===========================&gt;            | (72%) ETA: 2017-10-26 12:44:54

|===============================&gt;        | (82%) ETA: 2017-10-26 12:44:54

|=================================&gt;      | (86%) ETA: 2017-10-26 12:44:54

|====================================&gt;   | (93%) ETA: 2017-10-26 12:44:54

|=====================================&gt;  | (96%) ETA: 2017-10-26 12:44:54

|======================================&gt; | (99%) ETA: 2017-10-26 12:44:54

|=======================================&gt;| (100%) ETA: 2017-10-26 12:44:54

Sys.time()

## [1] &quot;2017-10-26 12:44:54 CEST&quot;
</code></pre><p>Again, the method performs very well after the first couple of entries.<br>Let’s look at the errors:<br><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-10-1.png" alt=""> No<br>surprises here. The quadratic estimator outperforms the rest.</p>
<h1 id="Simplification-and-generalization"><a href="#Simplification-and-generalization" class="headerlink" title="Simplification and generalization"></a>Simplification and generalization</h1><p>Of course, given that the Fortran module was developed on the fly, with<br>estimators added as need arose, it is no surprise that it seems messy<br>and confused. Also, since R is much better suited for things such as<br>fitting, I can replace the whole suite of estimators with a routine that<br>uses polynomial estimator in R. Furthermore, it is possible that we<br>encounter a task that is slow initially, but speeds up subsequently.<br>Therefore, I implemented the following estimators:</p>
<ul>
<li>polynomial</li>
<li>log-parabolic (fallback to polynomial if not enough points)</li>
</ul>
<p>All this will be used on a window (i.e., a small number of recent<br>entries). The window size can be controlled by the user, and can even<br>encompass all data.</p>
<p>Here is an implementation of the polynomial fitting routine:</p>
<pre><code>estatusbar.polynomial &lt;- function(private, frac, win) {

  num.entries &lt;- length(private$fracs)
  realwin &lt;- min(c(win, num.entries)) # the real window may be smaller than win

  # check if we can use the parabola or have to fallback to linear fit
  if (realwin &lt; 4) {
    par &lt;- FALSE
  } else {
    par &lt;- TRUE
  }

  # create a data frame to perform regression
  df &lt;- data.frame(fracs = private$fracs[(num.entries - realwin + 1):(num.entries)], times = private$measured[(num.entries - realwin + 1):(num.entries)])

  # regression
  if (par) {
    fit &lt;- lm(times ~ fracs + I(fracs^2), data = df)
  } else {
    fit &lt;- lm(times ~ fracs, data = df)
  }

  # create a data frame for predicting
  pdf &lt;- data.frame(fracs = c(frac))

  # predict the time at frac
  pdf$times &lt;- predict(fit, pdf)

  # if the prediction is negative, fallback to linear
  if (pdf$times[1] &lt; 0) {
    fit &lt;- lm(times ~ fracs, data = df)
    pdf$times &lt;- predict(fit, pdf)
    # if the prediction is still negative, set to 0
    if (pdf$times[1] &lt; 0) {
      pdf$times &lt;- 0
    }
  }

  return(pdf$times[1])
}
</code></pre><p>And here is the log-parabolic fitting routine with a fallback to the<br>previous one if the first point cannot be avoided (because both values<br>are zero):</p>
<pre><code>estatusbar.log &lt;- function(private, frac, win) {

    num.entries &lt;- length(private$fracs)
    realwin &lt;- min(c(win, num.entries)) # the real window may be smaller than win

    # fallback to estatusbar.polynomial if there are not enough points
    if (realwin &lt; 3) {
      return(estatusbar.polynomial(private, frac, win))
    }

    realwin &lt;- realwin - 1

    # check if we can use the parabola or have to fallback to linear fit
    if (realwin &lt; 4) {
      par &lt;- FALSE
    } else {
      par &lt;- TRUE
    }

    # ln(y) = A + B * ln(x) + C * ln(x)^2

    # create a data frame to perform regression
    df &lt;- data.frame(fracs = log(private$fracs[(num.entries - realwin + 1):(num.entries)]), times = log(private$measured[(num.entries - realwin + 1):(num.entries)]))

    # regression
    if (par) {
      fit &lt;- lm(times ~ fracs + I(fracs^2), data = df)
    } else {
      fit &lt;- lm(times ~ fracs, data = df)
    }

    # create a data frame for predicting
    pdf &lt;- data.frame(fracs = log(c(frac)))

    # predict the time at frac
    pdf$times &lt;- predict(fit, pdf)

    return(exp(pdf$times[1]))
}
</code></pre><h2 id="Testing-the-new-scheme"><a href="#Testing-the-new-scheme" class="headerlink" title="Testing the new scheme"></a>Testing the new scheme</h2><p>Let’s repeat the tests and perform some new ones.</p>
<h1 id="Linear-time"><a href="#Linear-time" class="headerlink" title="Linear time"></a>Linear time</h1><p><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-13-1.png" alt=""></p>
<p>As expected, both methods perform very well.</p>
<h1 id="Quadratic-time"><a href="#Quadratic-time" class="headerlink" title="Quadratic time"></a>Quadratic time</h1><p><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-14-1.png" alt=""></p>
<p>Again, and as expected, both methods perform very well.</p>
<h1 id="Cubic-time"><a href="#Cubic-time" class="headerlink" title="Cubic time"></a>Cubic time</h1><p>Let’s try a test with 20 time intervals where the time grows as the<br>third power.</p>
<p><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-15-1.png" alt=""></p>
<p>Looks good for the parabolic estimator. Let’s see it live in action:</p>
<pre><code>## [1] &quot;2017-10-26 12:44:56 CEST&quot;

## 

|=&gt;                                      | (05%) ETA: 2017-10-26 12:44:56

|=&gt;                                      | (07%) ETA: 2017-10-26 12:44:56

|===&gt;                                    | (12%) ETA: 2017-10-26 12:45:04

|=====&gt;                                  | (16%) ETA: 2017-10-26 12:45:24

|======&gt;                                 | (19%) ETA: 2017-10-26 12:47:06

|=========&gt;                              | (26%) ETA: 2017-10-26 12:46:05

|===========&gt;                            | (32%) ETA: 2017-10-26 12:45:51

|==============&gt;                         | (39%) ETA: 2017-10-26 12:45:58

|=================&gt;                      | (45%) ETA: 2017-10-26 12:46:02

|===================&gt;                    | (51%) ETA: 2017-10-26 12:45:57

|====================&gt;                   | (52%) ETA: 2017-10-26 12:45:56

|=======================&gt;                | (60%) ETA: 2017-10-26 12:45:58

|=======================&gt;                | (61%) ETA: 2017-10-26 12:45:56

|=========================&gt;              | (65%) ETA: 2017-10-26 12:45:52

|==========================&gt;             | (68%) ETA: 2017-10-26 12:45:56

|=============================&gt;          | (75%) ETA: 2017-10-26 12:45:56

|================================&gt;       | (83%) ETA: 2017-10-26 12:45:56

|===================================&gt;    | (91%) ETA: 2017-10-26 12:45:56

|======================================&gt; | (97%) ETA: 2017-10-26 12:45:56

|=======================================&gt;| (100%) ETA: 2017-10-26 12:45:56

## [1] &quot;2017-10-26 12:45:56 CEST&quot;
</code></pre><h1 id="Square-root-time"><a href="#Square-root-time" class="headerlink" title="Square-root time"></a>Square-root time</h1><p>Let’s try a test with 20 time intervals where the time grows as the<br>square root.</p>
<p><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-17-1.png" alt=""></p>
<p>Looks good for the parabolic estimator and the polynomial estimator<br>after some time. Let’s see it live in action:</p>
<pre><code>## [1] &quot;2017-10-26 12:45:56 CEST&quot;

## 

|=&gt;                                      | (06%) ETA: 2017-10-26 12:45:56

|==&gt;                                     | (08%) ETA: 2017-10-26 12:49:57

|===&gt;                                    | (11%) ETA: 2017-10-26 12:48:16

|======&gt;                                 | (19%) ETA: 2017-10-26 12:47:12

|========&gt;                               | (23%) ETA: 2017-10-26 12:47:00

|==========&gt;                             | (29%) ETA: 2017-10-26 12:46:58

|=============&gt;                          | (35%) ETA: 2017-10-26 12:46:55

|================&gt;                       | (43%) ETA: 2017-10-26 12:46:56

|=================&gt;                      | (45%) ETA: 2017-10-26 12:46:57

|==================&gt;                     | (48%) ETA: 2017-10-26 12:46:57

|====================&gt;                   | (54%) ETA: 2017-10-26 12:46:57

|=======================&gt;                | (62%) ETA: 2017-10-26 12:46:57

|=========================&gt;              | (65%) ETA: 2017-10-26 12:46:57

|===========================&gt;            | (72%) ETA: 2017-10-26 12:46:57

|============================&gt;           | (73%) ETA: 2017-10-26 12:46:57

|=============================&gt;          | (77%) ETA: 2017-10-26 12:46:57

|===============================&gt;        | (80%) ETA: 2017-10-26 12:46:57

|================================&gt;       | (82%) ETA: 2017-10-26 12:46:57

|===================================&gt;    | (90%) ETA: 2017-10-26 12:46:57

|=======================================&gt;| (100%) ETA: 2017-10-26 12:46:57

## [1] &quot;2017-10-26 12:46:57 CEST&quot;
</code></pre><h1 id="1-exp-time"><a href="#1-exp-time" class="headerlink" title="1-exp time"></a>1-exp time</h1><p>Let’s try a test with 20 time intervals where the time grows as the 1 -<br>exp(-5*frac). This is a case where most of the work is done initially.</p>
<p><img src="estatusbar_files/figure-markdown_strict/unnamed-chunk-19-1.png" alt=""></p>
<p>Both estimators do a good job after some time, but that may not be very<br>useful, since most of the calculation is spent in the early part, where<br>the estimators overestimate the time of completion.</p>
<pre><code>## [1] &quot;2017-10-26 12:46:57 CEST&quot;

## 

|&gt;                                        | (01%) ETA: 2017-10-26 12:46:57

|====&gt;                                   | (12%) ETA: 2017-10-26 12:51:46

|====&gt;                                   | (13%) ETA: 2017-10-26 12:50:13

|====&gt;                                   | (14%) ETA: 2017-10-26 12:50:11

|======&gt;                                 | (18%) ETA: 2017-10-26 12:49:28

|=========&gt;                              | (26%) ETA: 2017-10-26 12:49:10

|===========&gt;                            | (31%) ETA: 2017-10-26 12:48:33

|============&gt;                           | (32%) ETA: 2017-10-26 12:48:27

|================&gt;                       | (43%) ETA: 2017-10-26 12:48:05

|================&gt;                       | (43%) ETA: 2017-10-26 12:47:52

|==================&gt;                     | (48%) ETA: 2017-10-26 12:47:55

|===================&gt;                    | (50%) ETA: 2017-10-26 12:47:56

|====================&gt;                   | (52%) ETA: 2017-10-26 12:47:56

|========================&gt;               | (64%) ETA: 2017-10-26 12:47:57

|===========================&gt;            | (70%) ETA: 2017-10-26 12:47:56

|==============================&gt;         | (77%) ETA: 2017-10-26 12:47:57

|================================&gt;       | (83%) ETA: 2017-10-26 12:47:57

|=================================&gt;      | (85%) ETA: 2017-10-26 12:47:57

|===================================&gt;    | (91%) ETA: 2017-10-26 12:47:57

|=======================================&gt;| (100%) ETA: 2017-10-26 12:47:57

## [1] &quot;2017-10-26 12:47:57 CEST&quot;
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2017/10/26/A-simple-status-progress-bar-with-time-estimator/" data-id="cj98cn4gx000174srh6xe548a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-A-simple-but-nontrivial-Shiny-App" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/13/A-simple-but-nontrivial-Shiny-App/" class="article-date">
  <time datetime="2017-08-13T10:00:00.000Z" itemprop="datePublished">2017-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/13/A-simple-but-nontrivial-Shiny-App/">A simple (but nontrivial) Shiny App</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Some time ago I put it on my todo list to learn <a href="https://shiny.rstudio.com/" target="_blank" rel="external">Shiny</a>. I report my first non-trivial app, which is useful (for me at least), and also shows what can be done after even a few hours of work.</p>
<p>The app can be accessed here: <a href="https://petarmimica.shinyapps.io/baby/" target="_blank" rel="external">https://petarmimica.shinyapps.io/baby/</a>.</p>
<h1 id="Shiny-apps"><a href="#Shiny-apps" class="headerlink" title="Shiny apps"></a>Shiny apps</h1><p>As discussed <a href="https://shiny.rstudio.com/articles/basics.html" target="_blank" rel="external">here</a> and ellaborated in much more detail in the rest of the <a href="https://shiny.rstudio.com/articles/" target="_blank" rel="external">documentation</a>, a Shiny app is a <a href="https://en.wikipedia.org/wiki/Web_application" target="_blank" rel="external">web application</a> written in Gnu R with help of the Shiny library. It has two basic parts:</p>
<ul>
<li>User interface (UI): an R source file that declares the UI elements, their layout and the functions that are executed on the server with the goal of displaying something or reacting to user actions.</li>
<li>Server: an R source file that implements various functions that are needed for the UI to work properly, as well as any other auxiliary functions.</li>
</ul>
<p>The Shiny library is very powerful in that it allows the programmer to program <a href="https://shiny.rstudio.com/articles/reactivity-overview.html" target="_blank" rel="external">reactively</a>. What this means in practice is that a (possibly computationally very expensive) operation is only executed if the user changes one or more of the input parameters on which that operation depends. For example, the plotting routine may only be called if the user has done something that requires it to be redrawn, while another part of the UI may contain a text that only changes when the user clicks on a plot (without that plot needing to be redrawn).</p>
<h1 id="What-I-did"><a href="#What-I-did" class="headerlink" title="What I did"></a>What I did</h1><p>I wanted to create an app that displays measurements of some baby’s mass, height and head circumference. The app would let the user select what to display, and would perform a fit to a power-law dependence between the quantity and the number of days since birth. It would also allow the user to see what the model prediction for today is, as well as for another, user-specified date. It would also allow the user to change the date up to which the data is plotted. Finally, it would allow the user to click anywhere on a chart and get the values of that point.</p>
<p>Here is what the current version looks like: <img src="/images/shiny1.png" alt="Shiny1.app"></p>
<p>I have annotated the UI elements, as well as the points and curves on the chart.</p>
<h1 id="How-it-was-done"><a href="#How-it-was-done" class="headerlink" title="How it was done"></a>How it was done</h1><p>I hardcoded the data (there are only 6 points, so it was much easier to do). Then I did some processing on the data to make it easier to perform fits. The first Shiny related code concerns the definition of two global variables that contain the predictions for today and for user date:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reactively bound variables that store the user selected and today estimate</span></div><div class="line">user.y &lt;- <span class="literal">NULL</span></div><div class="line">today.y &lt;- <span class="literal">NULL</span></div></pre></td></tr></table></figure>
<p>Next comes the main server function:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># server function</span></div><div class="line">shinyServer(<span class="keyword">function</span>(input, output) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Before diving into it, let me introduce some user interface elements. I used the <a href="http://rstudio.github.io/shinydashboard/get_started.html" target="_blank" rel="external">shinydashoard</a> library to make it easier to organize the UI and to extend it in the future. The code for the full UI is surprisingly short:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">dashboardPage(</div><div class="line">  dashboardHeader(disable = <span class="literal">TRUE</span>),</div><div class="line">  dashboardSidebar(disable = <span class="literal">TRUE</span>),</div><div class="line">  </div><div class="line">  dashboardBody(</div><div class="line">    </div><div class="line">    <span class="comment"># Explanation</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="string">"Introduction"</span>,</div><div class="line">        htmlOutput(<span class="string">"intro"</span>)         </div><div class="line">    ),   </div><div class="line">    </div><div class="line">    <span class="comment"># Display chart</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="literal">NULL</span>,</div><div class="line">        plotOutput(<span class="string">"bioPlot"</span>, click = clickOpts(id =<span class="string">"chartClick"</span>))          </div><div class="line">    ),</div><div class="line">    </div><div class="line">    </div><div class="line">    fluidRow(</div><div class="line">      <span class="comment"># Variable selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          selectInput(<span class="string">"biometric"</span>, <span class="string">"Which biometric do you want to see?"</span>, list(<span class="string">"Body mass"</span> = <span class="string">"mass"</span>, <span class="string">"Height"</span> = <span class="string">"height"</span>, <span class="string">"Head circumference"</span> = <span class="string">"head"</span>))), </div><div class="line">      </div><div class="line">      <span class="comment"># User date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"query"</span>, <span class="string">"Which date are you interested in?"</span>)),</div><div class="line">      </div><div class="line">      <span class="comment"># Maximum date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"maxDate"</span>, <span class="string">"Up to which date do you wish to display?"</span>, value = <span class="string">"2018-01-31"</span>))</div><div class="line">      ),</div><div class="line">      </div><div class="line">    </div><div class="line">    <span class="comment"># Textual information boxes</span></div><div class="line">    fluidRow(</div><div class="line">      </div><div class="line">      <span class="comment"># Clicked point</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Values (click on the chart):"</span>,</div><div class="line">          textOutput(<span class="string">"chartInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for today</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estmate (today):"</span>,</div><div class="line">          textOutput(<span class="string">"todayInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for user selected date</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estimate (user selected date):"</span>,</div><div class="line">          textOutput(<span class="string">"userInfo"</span>))</div><div class="line">    )</div><div class="line">    </div><div class="line">  ) </div><div class="line">)</div></pre></td></tr></table></figure>
<p>Each element is encapsulated in the <code>box()</code> function, and sometimes the boxes are arranged in rows using the <code>fluidRow()</code> function. Inside the boxes there is a function that tells Shiny what kind of input or output is contained. For example, the introductory text is encapsulated inside <code>htmlOutput()</code>, while the pop-up menu for selecting the varibale goes inside <code>selectInput()</code>. The routines are pretty intuitive. The important thing to remember is that Shiny declares the <code>input</code> and <code>output</code> variables that are passed to the <code>shinyServer</code> function. Those variables are list whose elements are precisely the names passed to various input and output functions (e.g., <code>htmlOutput(&quot;intro&quot;)</code> causes an implementation of the <code>output$intro</code> function to be required inside <code>shinyServer</code>, while <code>dateInput(&quot;query&quot;)</code> causes a variable <code>input$query</code> to be defioned inside <code>shinyServer</code>).</p>
<p>My <code>shinyServer</code> starts by declaring those two variables, <code>user.y</code> and <code>today.y</code> as reactive:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># reactively bind user.y and today.y</span></div><div class="line">  makeReactiveBinding(<span class="string">"user.y"</span>)</div><div class="line">  makeReactiveBinding(<span class="string">"today.y"</span>)</div></pre></td></tr></table></figure>
<p>The implementation of the plotting routine follows this format:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># plot rendering routine</span></div><div class="line">  output$bioPlot &lt;- renderPlot(&#123;</div><div class="line">    </div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<p>Inside this functions there are several other functions. They all contain references to the elements of <code>input</code>. If any of those elements are changed, <code>output$bioPlot</code> gets called. This is done internally by Shiny and I do not need to worry about it. For example, I declared three functions that help me generate the correct variable name and its corresponding physical unit:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># select the correct current data frame</span></div><div class="line">    dfSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = mass.df, <span class="string">"height"</span> = height.df, <span class="string">"head"</span> = head.df)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct unit</span></div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct variable name including unit</span></div><div class="line">    varSelect &lt;- reactive(&#123;</div><div class="line">      paste(input$biometric, <span class="string">" ["</span>, unitSelect(), <span class="string">"]"</span>, sep = <span class="string">""</span>)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>Note the <code>reactive</code> keyword, which is what Shiny uses to determine the dependencies. The fitting routine is also reactive and it returns a list with predictions and also with the fit coefficients:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># fit the to the currently active data frame</span></div><div class="line">    currentFit &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># power-law fit: log(y) = A0 + A1 * log(x) &lt;-&gt; y = A0 * x^A1</span></div><div class="line">      fit &lt;- nls(ly ~ A0 + A1 * lx, data = dfSelect(), start=list(A0 = <span class="number">3.2</span>, A1 = <span class="number">0.0</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit parameters</span></div><div class="line">      coefs &lt;- fit$m$getPars()</div><div class="line">      </div><div class="line">      <span class="comment"># compute x values for predictions (using user selectable maxDate)</span></div><div class="line">      pred &lt;- data.frame(x = <span class="number">1</span>:(as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))))</div><div class="line">      <span class="comment"># compute the predicted y value</span></div><div class="line">      pred &lt;- pred %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      </div><div class="line">      <span class="comment"># return list with predictions and coefficients</span></div><div class="line">      list(pred=pred, coefs=coefs)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>To compute the predictions for today and for a user selected date I do the following:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compute the user date prediction (shown as horizontal line)</span></div><div class="line">   userData &lt;- reactive(&#123;</div><div class="line">     </div><div class="line">     <span class="comment"># create a small data frame with two points</span></div><div class="line">     user.df &lt;- data.frame(x=rep(as.numeric(ymd(input$query) - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">     </div><div class="line">     <span class="comment"># get fit coefficients</span></div><div class="line">     coefs &lt;- currentFit()$coefs</div><div class="line">     </div><div class="line">     <span class="comment"># compute the corresponding y values</span></div><div class="line">     user.df &lt;- user.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">     user.y &lt;&lt;- user.df$y[<span class="number">1</span>]</div><div class="line">     user.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">   &#125;)</div><div class="line">   </div><div class="line">   <span class="comment"># compute today's prediction (shown as horizontal line)</span></div><div class="line">   todayData &lt;- reactive(&#123;</div><div class="line">     </div><div class="line">     <span class="comment"># create a small data frame with two points</span></div><div class="line">     today.df &lt;- data.frame(x=rep(as.numeric(today() - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">     </div><div class="line">     <span class="comment"># get fit coefficients</span></div><div class="line">     coefs &lt;- currentFit()$coefs</div><div class="line">     </div><div class="line">     <span class="comment"># compute the corresponding y values</span></div><div class="line">     today.df &lt;- today.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">     today.y &lt;&lt;- today.df$y[<span class="number">1</span>]</div><div class="line">     today.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">   &#125;)</div></pre></td></tr></table></figure>
<p>Note that in these routines the variables <code>user.y</code> and <code>today.y</code> are set. This is done to avoid having to recompute unnecessarily them when they are used by the output routines:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># display today's info</span></div><div class="line">output$todayInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (!is.null(today.y)) &#123;</div><div class="line">    y &lt;- today.y</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, today(), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment"># display user selected date info</span></div><div class="line">output$userInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (!is.null(user.y)) &#123;</div><div class="line">    y &lt;- user.y</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, input$query, <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Note that these routines only return a non-null result if the variables <code>today.y</code> and <code>user.y</code> are themselves non-null. This is to avoid any problems with initializing the user interface. The true power of reactive programming is shown here, because <code>output$userInfo</code> does not need to recompute the <code>user.y</code> if e.g., <code>input$query</code> changes, becuase <code>userData</code> function inside <code>output$bioPlot</code> will be called anyway and it will compute the new value.</p>
<p>The rest of the plotting routine concerns itself with computing the minimum and maximum y values inside the range requested by the user (i.e., <code>input$maxDate</code> is a reactive variable used here):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compute the y limits based on the user selectable date range</span></div><div class="line">    </div><div class="line">    <span class="comment"># store predictions in preds</span></div><div class="line">    preds &lt;- currentFit()$pred</div><div class="line">    </div><div class="line">    <span class="comment"># compute the maximum number of days to be shown</span></div><div class="line">    max.days &lt;- as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))</div><div class="line">    </div><div class="line">    <span class="comment"># compute y range</span></div><div class="line">    y.min &lt;- min(preds$y[preds$x &lt;= max.days])</div><div class="line">    y.max &lt;- max(preds$y[preds$x &lt;= max.days])</div><div class="line">    </div><div class="line">    ud &lt;- userData()</div><div class="line">    td &lt;- todayData()</div><div class="line">    </div><div class="line">    <span class="comment"># plot</span></div><div class="line">   ggplot(<span class="literal">NULL</span>) +<span class="comment"># plot multiple data frames, so start with null</span></div><div class="line">   mytheme +<span class="comment"># add the theme</span></div><div class="line">   geom_point(data = dfSelect(), aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) +<span class="comment"># plot measurements</span></div><div class="line">     geom_line(data = preds, aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) + <span class="comment"># plot predictions</span></div><div class="line">   scale_x_date(limits = ymd(c(<span class="string">"2017-01-31"</span>), input$maxDate)) + scale_y_continuous(limits = c(y.min, y.max)) + <span class="comment"># set x and y limits</span></div><div class="line">     xlab(<span class="string">"date"</span>) + ylab(varSelect()) <span class="comment"># axis labels</span></div></pre></td></tr></table></figure>
<p>The function <code>output$chartInfo</code> shows the values at the position where the user last clicked inside the graph. It is connected to the plot via the <code>clickOpts</code> keyword in the UI definition: <code>plotOutput(&quot;bioPlot&quot;, click = clickOpts(id =&quot;chartClick&quot;))</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># display click info</span></div><div class="line">output$chartInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(!is.null(input$chartClick))&#123;</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, as.Date(input$chartClick$x - <span class="number">17197</span>, origin=ymd(<span class="string">"2017-01-31"</span>)), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(input$chartClick$y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>Note how the UI and server are easily connected using labels passed to the UI definition functions.</p>
<h1 id="The-full-code-except-for-data"><a href="#The-full-code-except-for-data" class="headerlink" title="The full code (except for data)"></a>The full code (except for data)</h1><p>This Shiny app has two source files, but it could also have been written in a single file. The UI definition is in the <code>ui.R</code> file:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># User interface code</span></div><div class="line"><span class="comment"># Author: Petar Mimica &lt;petar.mimica@gmail.com&gt;, August 2017</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(shiny)</div><div class="line"><span class="keyword">library</span>(shinydashboard)</div><div class="line"></div><div class="line"></div><div class="line">dashboardPage(</div><div class="line">  dashboardHeader(disable = <span class="literal">TRUE</span>),</div><div class="line">  dashboardSidebar(disable = <span class="literal">TRUE</span>),</div><div class="line">  </div><div class="line">  dashboardBody(</div><div class="line">    </div><div class="line">    <span class="comment"># Explanation</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="string">"Introduction"</span>,</div><div class="line">        htmlOutput(<span class="string">"intro"</span>)         </div><div class="line">    ),   </div><div class="line">    </div><div class="line">    <span class="comment"># Display chart</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="literal">NULL</span>,</div><div class="line">        plotOutput(<span class="string">"bioPlot"</span>, click = clickOpts(id =<span class="string">"chartClick"</span>))          </div><div class="line">    ),</div><div class="line">    </div><div class="line">    </div><div class="line">    fluidRow(</div><div class="line">      <span class="comment"># Variable selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          selectInput(<span class="string">"biometric"</span>, <span class="string">"Which biometric do you want to see?"</span>, list(<span class="string">"Body mass"</span> = <span class="string">"mass"</span>, <span class="string">"Height"</span> = <span class="string">"height"</span>, <span class="string">"Head circumference"</span> = <span class="string">"head"</span>))), </div><div class="line">      </div><div class="line">      <span class="comment"># User date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"query"</span>, <span class="string">"Which date are you interested in?"</span>)),</div><div class="line">      </div><div class="line">      <span class="comment"># Maximum date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"maxDate"</span>, <span class="string">"Up to which date do you wish to display?"</span>, value = <span class="string">"2018-01-31"</span>))</div><div class="line">      ),</div><div class="line">      </div><div class="line">    </div><div class="line">    <span class="comment"># Textual information boxes</span></div><div class="line">    fluidRow(</div><div class="line">      </div><div class="line">      <span class="comment"># Clicked point</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Values (click on the chart):"</span>,</div><div class="line">          textOutput(<span class="string">"chartInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for today</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estmate (today):"</span>,</div><div class="line">          textOutput(<span class="string">"todayInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for user selected date</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estimate (user selected date):"</span>,</div><div class="line">          textOutput(<span class="string">"userInfo"</span>))</div><div class="line">    )</div><div class="line">    </div><div class="line">  ) </div><div class="line">)</div></pre></td></tr></table></figure>
<p>The server is in <code>server.R</code>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Server code</span></div><div class="line"><span class="comment"># Author: Petar Mimica &lt;petar.mimica@gmail.com&gt;, August 2017</span></div><div class="line"></div><div class="line"><span class="comment"># Load libraries</span></div><div class="line"><span class="keyword">library</span>(shiny)</div><div class="line"><span class="keyword">library</span>(lubridate)</div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(tidyr)</div><div class="line"><span class="keyword">library</span>(dplyr)</div><div class="line"></div><div class="line"><span class="comment"># Define a ggplot theme</span></div><div class="line">mytheme &lt;- theme_bw() + theme(axis.text=element_text(size=<span class="number">14</span>))+theme(axis.title=element_text(size=<span class="number">14</span>))+theme(axis.line=element_line(size=<span class="number">2</span>))+theme(legend.text=element_text(size=<span class="number">12</span>))+theme(legend.title=element_text(size=<span class="number">14</span>))+theme(legend.key = element_blank(), legend.key.width = unit(<span class="number">18</span>, <span class="string">"points"</span>))</div><div class="line"></div><div class="line"><span class="comment"># Define the data frames (*** fill in your own data***)</span></div><div class="line">mass.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">3000</span>, <span class="number">3001</span>))</div><div class="line">height.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">50</span>, <span class="number">51</span>))</div><div class="line">head.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">32</span>, <span class="number">33</span>))</div><div class="line"></div><div class="line"><span class="comment"># Process the data frames</span></div><div class="line">mass.df &lt;- mass.df %&gt;% mutate(y = y / <span class="number">1e3</span>, x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line">height.df &lt;- height.df %&gt;% mutate(x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line">head.df &lt;- head.df %&gt;% mutate(x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line"></div><div class="line"><span class="comment"># Reactively bound variables that store the user selected and today estimate</span></div><div class="line">user.y &lt;- <span class="literal">NULL</span></div><div class="line">today.y &lt;- <span class="literal">NULL</span></div><div class="line"></div><div class="line"><span class="comment"># server function</span></div><div class="line">shinyServer(<span class="keyword">function</span>(input, output) &#123;</div><div class="line">  </div><div class="line">  <span class="comment"># reactively bind user.y and today.y</span></div><div class="line">  makeReactiveBinding(<span class="string">"user.y"</span>)</div><div class="line">  makeReactiveBinding(<span class="string">"today.y"</span>)</div><div class="line">  </div><div class="line">  <span class="comment"># plot rendering routine</span></div><div class="line">  output$bioPlot &lt;- renderPlot(&#123;</div><div class="line">    </div><div class="line">    <span class="comment"># select the correct current data frame</span></div><div class="line">    dfSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = mass.df, <span class="string">"height"</span> = height.df, <span class="string">"head"</span> = head.df)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct unit</span></div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct variable name including unit</span></div><div class="line">    varSelect &lt;- reactive(&#123;</div><div class="line">      paste(input$biometric, <span class="string">" ["</span>, unitSelect(), <span class="string">"]"</span>, sep = <span class="string">""</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment"># fit the to the currently active data frame</span></div><div class="line">    currentFit &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># power-law fit: log(y) = A0 + A1 * log(x) &lt;-&gt; y = A0 * x^A1</span></div><div class="line">      fit &lt;- nls(ly ~ A0 + A1 * lx, data = dfSelect(), start=list(A0 = <span class="number">3.2</span>, A1 = <span class="number">0.0</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit parameters</span></div><div class="line">      coefs &lt;- fit$m$getPars()</div><div class="line">      </div><div class="line">      <span class="comment"># compute x values for predictions (using user selectable maxDate)</span></div><div class="line">      pred &lt;- data.frame(x = <span class="number">1</span>:(as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))))</div><div class="line">      <span class="comment"># compute the predicted y value</span></div><div class="line">      pred &lt;- pred %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      </div><div class="line">      <span class="comment"># return list with predictions and coefficients</span></div><div class="line">      list(pred=pred, coefs=coefs)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the user date prediction (shown as horizontal line)</span></div><div class="line">    userData &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># create a small data frame with two points</span></div><div class="line">      user.df &lt;- data.frame(x=rep(as.numeric(ymd(input$query) - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit coefficients</span></div><div class="line">      coefs &lt;- currentFit()$coefs</div><div class="line">      </div><div class="line">      <span class="comment"># compute the corresponding y values</span></div><div class="line">      user.df &lt;- user.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      user.y &lt;&lt;- user.df$y[<span class="number">1</span>]</div><div class="line">      user.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute today's prediction (shown as horizontal line)</span></div><div class="line">    todayData &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># create a small data frame with two points</span></div><div class="line">      today.df &lt;- data.frame(x=rep(as.numeric(today() - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit coefficients</span></div><div class="line">      coefs &lt;- currentFit()$coefs</div><div class="line">      </div><div class="line">      <span class="comment"># compute the corresponding y values</span></div><div class="line">      today.df &lt;- today.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      today.y &lt;&lt;- today.df$y[<span class="number">1</span>]</div><div class="line">      today.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">    &#125;)  </div><div class="line">    </div><div class="line">    <span class="comment"># compute the y limits based on the user selectable date range</span></div><div class="line">    </div><div class="line">    <span class="comment"># store predictions in preds</span></div><div class="line">    preds &lt;- currentFit()$pred</div><div class="line">    </div><div class="line">    <span class="comment"># compute the maximum number of days to be shown</span></div><div class="line">    max.days &lt;- as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))</div><div class="line">    </div><div class="line">    <span class="comment"># compute y range</span></div><div class="line">    y.min &lt;- min(preds$y[preds$x &lt;= max.days])</div><div class="line">    y.max &lt;- max(preds$y[preds$x &lt;= max.days])</div><div class="line">    </div><div class="line">    ud &lt;- userData()</div><div class="line">    td &lt;- todayData()</div><div class="line">    </div><div class="line">    <span class="comment"># plot</span></div><div class="line">    ggplot(<span class="literal">NULL</span>) +<span class="comment"># plot multiple data frames, so start with null</span></div><div class="line">      mytheme +<span class="comment"># add the theme</span></div><div class="line">      geom_point(data = dfSelect(), aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) +<span class="comment"># plot measurements</span></div><div class="line">      geom_line(data = preds, aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) + <span class="comment"># plot predictions</span></div><div class="line">      scale_x_date(limits = ymd(c(<span class="string">"2017-01-31"</span>), input$maxDate)) + scale_y_continuous(limits = c(y.min, y.max)) + <span class="comment"># set x and y limits</span></div><div class="line">      xlab(<span class="string">"date"</span>) + ylab(varSelect()) <span class="comment"># axis labels</span></div><div class="line">    </div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="comment"># display click info</span></div><div class="line">  output$chartInfo &lt;- renderPrint(&#123;</div><div class="line">    </div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(!is.null(input$chartClick))&#123;</div><div class="line">      cat(paste(<span class="string">"Date: "</span>, as.Date(input$chartClick$x - <span class="number">17197</span>, origin=ymd(<span class="string">"2017-01-31"</span>)), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(input$chartClick$y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment"># display today's info</span></div><div class="line">    output$todayInfo &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      unitSelect &lt;- reactive(&#123;</div><div class="line">        <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">      &#125;)</div><div class="line">      </div><div class="line">      <span class="keyword">if</span> (!is.null(today.y)) &#123;</div><div class="line">        y &lt;- today.y</div><div class="line">        cat(paste(<span class="string">"Date: "</span>, today(), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># display user selected date info</span></div><div class="line">    output$userInfo &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      unitSelect &lt;- reactive(&#123;</div><div class="line">        <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">      &#125;)</div><div class="line">      </div><div class="line">      <span class="keyword">if</span> (!is.null(user.y)) &#123;</div><div class="line">        y &lt;- user.y</div><div class="line">        cat(paste(<span class="string">"Date: "</span>, input$query, <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># introductory text</span></div><div class="line">    output$intro &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      cat(<span class="string">"This is an example of a Shiny app that displays a chart of three different datasets and uses a power-law fit (y = a*x^b) to model the data. The user can select which data to show, and can also obtain information about predictions for today and for a user selecte date. Clicking on a chart shows the values at the point clicked. More information can be found &lt;a href='http://www.uv.es/mimica/Rblog/shiny1.html'&gt;on my blog&lt;/a&gt;."</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">&#125;)</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2017/08/13/A-simple-but-nontrivial-Shiny-App/" data-id="cj98cn4h0000274srg8b3zril" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-R-versus-C-and-Fortran" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/08/R-versus-C-and-Fortran/" class="article-date">
  <time datetime="2017-08-08T10:00:00.000Z" itemprop="datePublished">2017-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/08/R-versus-C-and-Fortran/">R versus C++ (and Fortran)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The purpose of this post is to illustrate how to integrate the C++ code into R using Rcpp library, and also to test how fast it is compared to R implementations of the minmod reconstruction often used in finite volume methods. I also show a comparison with a Fortran code.</p>
<p>Note that the details of what minmod exactly does are not crucial here. Check page 5 of <a href="https://ocw.mit.edu/courses/mathematics/18-336-numerical-methods-for-partial-differential-equations-spring-2009/lecture-notes/MIT18_336S09_lec19.pdf" target="_blank" rel="external">this document</a> for a quick overview. The point is that it involves a series of straightforward floating point vector operations and one part where two decisions need to be taken in order to compute the final result.</p>
<h1 id="Compile-the-C-code"><a href="#Compile-the-C-code" class="headerlink" title="Compile the C++ code:"></a>Compile the C++ code:</h1><p>This is the C++ routine that is compiled and imported into R using the <a href="http://www.rcpp.org/" target="_blank" rel="external">Rcpp</a> library.</p>
<pre><code>## #include &lt;Rcpp.h&gt;
## using namespace Rcpp;
## 
## // [[Rcpp::export]]
## NumericMatrix minModRec(NumericVector x, NumericVector u) {
##   
##   int n = x.size();
##   NumericMatrix res(n - 2, 4);
##   NumericVector dxm(n - 2), dxp(n - 2), dum(n - 2), dup(n - 2), du(n - 2);
##   
##   for (int i = 1; i &lt; n - 1; ++i)
##     dxm[i - 1] = x[i] - x[i - 1];
## 
##   for (int i = 1; i &lt; n - 1; ++i)
##     dxp[i - 1] = x[i + 1] - x[i];
##   
##   for (int i = 1; i &lt; n - 1; ++i)
##     dum[i - 1] = (u[i] - u[i - 1]) / dxm[i - 1];
## 
##   for (int i = 1; i &lt; n - 1; ++i)
##     dup[i - 1] = (u[i + 1] - u[i]) / dxp[i - 1];
##   
##  for (int i = 0; i &lt; n - 2; ++i)
##     du[i] = (dum[i] * dup[i] &lt; 0e0 ? 0e0 : (std::abs(dum[i]) &lt; std::abs(dup[i]) ? dum[i] : dup[i]));
##   
##   for (int i = 1; i &lt; n - 1; ++i)
##     res(i - 1, 0) = 5e-1 * (x[i] + x[i - 1]);
## 
##   for (int i = 1; i &lt; n - 1; ++i)
##     res(i - 1, 1) = 5e-1 * (x[i + 1] + x[i]);
##   
##     
##   for (int i = 1; i &lt; n - 1; ++i)
##     res(i - 1, 2) = u[i] - du[i - 1] * 5e-1 * dxm[i - 1];
##   
##   for (int i = 1; i &lt; n - 1; ++i)
##     res(i - 1, 3) = u[i] + du[i - 1] * 5e-1 * dxp[i - 1];
##   
##   return(res);
##     
## }
## 
## 
## // You can include R code blocks in C++ files processed with sourceCpp
## // (useful for testing and development). The R code will be automatically 
## // run after the compilation.
## //
## 
## /*** R
## print(&quot;R test: &quot;)
## minModRec(1:10, 1:10)
## */
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(Rcpp)</div><div class="line">sourceCpp(<span class="string">"minModRec.cpp"</span>)</div></pre></td></tr></table></figure>
<pre><code>## 
## &gt; print(&quot;R test: &quot;)
## [1] &quot;R test: &quot;
## 
## &gt; minModRec(1:10, 1:10)
##      [,1] [,2] [,3] [,4]
## [1,]  1.5  2.5  1.5  2.5
## [2,]  2.5  3.5  2.5  3.5
## [3,]  3.5  4.5  3.5  4.5
## [4,]  4.5  5.5  4.5  5.5
## [5,]  5.5  6.5  5.5  6.5
## [6,]  6.5  7.5  6.5  7.5
## [7,]  7.5  8.5  7.5  8.5
## [8,]  8.5  9.5  8.5  9.5
</code></pre><h1 id="Implementation-in-R"><a href="#Implementation-in-R" class="headerlink" title="Implementation in R"></a>Implementation in R</h1><p>I implemented two versions in R. The main difference is in the usage of ifelse.</p>
<p>Version 1:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">RminModRec &lt;- <span class="keyword">function</span>(x, u) &#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  rng &lt;- <span class="number">2</span>:(n - <span class="number">1</span>)</div><div class="line"></div><div class="line">  dxm &lt;- x[rng] - x[rng - <span class="number">1</span>]</div><div class="line">  dxp &lt;- x[rng + <span class="number">1</span>] - x[rng]</div><div class="line">  </div><div class="line">  dum &lt;- (u[rng] - u[rng - <span class="number">1</span>]) / dxm</div><div class="line">  dup &lt;- (u[rng + <span class="number">1</span>] - u[rng]) / dxp</div><div class="line"></div><div class="line">  du &lt;- ifelse(dum * dup &lt; <span class="number">0e0</span>, <span class="number">0e0</span>, ifelse(abs(dum) &lt; abs(dup), dum, dup))</div><div class="line"></div><div class="line">  res &lt;- array(dim=c(n - <span class="number">2</span>, <span class="number">4</span>))</div><div class="line">  </div><div class="line">  res[,<span class="number">1</span>] &lt;- <span class="number">5e-1</span> * (x[rng] + x[rng - <span class="number">1</span>])</div><div class="line">  res[,<span class="number">2</span>] &lt;- <span class="number">5e-1</span> * (x[rng + <span class="number">1</span>] + x[rng])</div><div class="line">  res[,<span class="number">3</span>] &lt;- u[rng] - du * <span class="number">5e-1</span> * dxm</div><div class="line">  res[,<span class="number">4</span>] &lt;- u[rng] + du * <span class="number">5e-1</span> * dxp</div><div class="line">  </div><div class="line">  <span class="keyword">return</span>(res)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Version 2:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">RminModRec2 &lt;- <span class="keyword">function</span>(x, u) &#123;</div><div class="line">  n &lt;- length(x)</div><div class="line">  rng &lt;- <span class="number">2</span>:(n - <span class="number">1</span>)</div><div class="line"></div><div class="line">  dxm &lt;- x[rng] - x[rng - <span class="number">1</span>]</div><div class="line">  dxp &lt;- x[rng + <span class="number">1</span>] - x[rng]</div><div class="line">  </div><div class="line">  dum &lt;- (u[rng] - u[rng - <span class="number">1</span>]) / dxm</div><div class="line">  dup &lt;- (u[rng + <span class="number">1</span>] - u[rng]) / dxp</div><div class="line"></div><div class="line">  dum2 &lt;- dum^<span class="number">2</span></div><div class="line">  dup2 &lt;- dup^<span class="number">2</span></div><div class="line">  dumdup &lt;- dum * dup</div><div class="line">  </div><div class="line">  du &lt;- dum</div><div class="line">  dmask &lt;- dum2 &gt; dup2</div><div class="line">  du[dmask] &lt;- dup[dmask]</div><div class="line">  du[dumdup &lt; <span class="number">0e0</span>] &lt;- <span class="number">0e0</span></div><div class="line">  </div><div class="line">  res &lt;- array(dim=c(n - <span class="number">2</span>, <span class="number">4</span>))</div><div class="line"></div><div class="line">  res[,<span class="number">1</span>] &lt;- <span class="number">5e-1</span> * (x[rng] + x[rng - <span class="number">1</span>])</div><div class="line">  res[,<span class="number">2</span>] &lt;- <span class="number">5e-1</span> * (x[rng + <span class="number">1</span>] + x[rng])</div><div class="line">  res[,<span class="number">3</span>] &lt;- u[rng] - du * <span class="number">5e-1</span> * dxm</div><div class="line">  res[,<span class="number">4</span>] &lt;- u[rng] + du * <span class="number">5e-1</span> * dxp</div><div class="line">  </div><div class="line">  <span class="keyword">return</span>(res)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Create-an-initial-state"><a href="#Create-an-initial-state" class="headerlink" title="Create an initial state:"></a>Create an initial state:</h1><p>To begin, I create an initial state that consists of two constant states separated by a discontinuity:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x &lt;- seq(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>)</div><div class="line">u &lt;- c(rep(<span class="number">2</span>, <span class="number">5</span>), rep(<span class="number">1</span>, <span class="number">6</span>))</div><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x = x, y = u))), points = c(<span class="literal">TRUE</span>), xlab=<span class="string">"x"</span>, ylab=<span class="string">"u"</span>, ylim=c(<span class="number">0</span>, <span class="number">2.2</span>), labels=c(<span class="string">"Initial values"</span>), legend.name = <span class="string">"Data"</span>, grid=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-6-1.png" alt=""></p>
<p>Now I econstruct using both C++ and R routines and plot the maximum differences (should be zero):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">recCpp &lt;- minModRec(x, u)</div><div class="line">recR &lt;- RminModRec(x, u)</div><div class="line">recR2 &lt;- RminModRec(x, u)</div><div class="line">max(abs(recCpp - recR))</div></pre></td></tr></table></figure>
<pre><code>## [1] 0
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max(abs(recCpp - recR2))</div></pre></td></tr></table></figure>
<pre><code>## [1] 0
</code></pre><p>Now I plot the reconstructed values:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x = x, y = u), pltptsgg.get.curve(x = recCpp[,<span class="number">1</span>], y = recCpp[,<span class="number">3</span>]), pltptsgg.get.curve(x = recCpp[,<span class="number">2</span>], y = recCpp[,<span class="number">4</span>]))), points = c(<span class="literal">TRUE</span>, <span class="literal">TRUE</span>, <span class="literal">TRUE</span>), xlab=<span class="string">"x"</span>, ylab=<span class="string">"u"</span>, ylim=c(<span class="number">0</span>, <span class="number">2.2</span>), labels=c(<span class="string">"initial values"</span>, <span class="string">"left"</span>, <span class="string">"right"</span>), legend.name = <span class="string">"Data"</span>, grid=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-8-1.png" alt=""></p>
<h1 id="Measure-performance-using-1000-points"><a href="#Measure-performance-using-1000-points" class="headerlink" title="Measure performance using 1000 points:"></a>Measure performance using 1000 points:</h1><p>First, let’s measure the performance using 1000 points:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(microbenchmark)</div><div class="line">x &lt;- seq(<span class="number">0</span>, <span class="number">1000</span>)</div><div class="line">u &lt;- c(rep(<span class="number">2</span>, <span class="number">500</span>), rep(<span class="number">1</span>, <span class="number">501</span>))</div><div class="line">res &lt;- microbenchmark(minModRec(x, u), RminModRec(x, u), RminModRec2(x, u), times = <span class="number">1000</span>)</div><div class="line">print(res)</div></pre></td></tr></table></figure>
<pre><code>## Unit: microseconds
##               expr     min       lq      mean   median       uq       max
##    minModRec(x, u)  18.963  23.1115  58.34623  26.7740  35.6405  2590.464
##   RminModRec(x, u) 275.205 315.0175 694.84095 369.2865 478.7540 77591.049
##  RminModRec2(x, u) 192.073 219.6845 398.18222 252.2565 317.2840 27592.042
##  neval
##   1000
##   1000
##   1000
</code></pre><p>Plot the measurements:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">autoplot(res)</div></pre></td></tr></table></figure>
<p><img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-10-1.png" alt=""></p>
<p>C++ is much faster than either of R routines, and version 2 is faster than version 1.</p>
<h1 id="Measure-performance-using-10000-points-and-random-data"><a href="#Measure-performance-using-10000-points-and-random-data" class="headerlink" title="Measure performance using 10000 points and random data:"></a>Measure performance using 10000 points and random data:</h1><p>Now we run a larger test with random initial data:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(microbenchmark)</div><div class="line">x &lt;- seq(<span class="number">0</span>, <span class="number">10000</span>)</div><div class="line">u &lt;- runif(<span class="number">10001</span>)</div><div class="line">res &lt;- microbenchmark(minModRec(x, u), RminModRec(x, u), RminModRec2(x, u), times = <span class="number">100</span>)</div><div class="line">print(res)</div></pre></td></tr></table></figure>
<pre><code>## Unit: microseconds
##               expr      min       lq      mean    median        uq
##    minModRec(x, u)  147.624  188.834  357.5853  244.3735  298.4105
##   RminModRec(x, u) 3329.903 4987.316 8139.7837 5806.7150 6831.5135
##  RminModRec2(x, u) 2023.073 2552.851 4399.0807 3521.3895 4171.0115
##       max neval
##   2252.14   100
##  87064.53   100
##  86612.22   100
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max(abs(recCpp - recR))</div></pre></td></tr></table></figure>
<pre><code>## [1] 0
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max(abs(recCpp - recR2))</div></pre></td></tr></table></figure>
<pre><code>## [1] 0
</code></pre><h1 id="Measure-performance-using-a-non-random-non-trivial-input"><a href="#Measure-performance-using-a-non-random-non-trivial-input" class="headerlink" title="Measure performance using a non-random, non-trivial input"></a>Measure performance using a non-random, non-trivial input</h1><p>In order to standardize the bechmarks, I generate the input data using some equation. This is how the input data looks like. The reconstruction was done using only 20 points, to better illustrate the minmod scheme. <img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-12-1.png" alt=""></p>
<h1 id="Check-scaling"><a href="#Check-scaling" class="headerlink" title="Check scaling"></a>Check scaling</h1><p>Here I run minmod on problems with different sizes and check how the median executon time scales with the number of points:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">ns &lt;- c(<span class="number">10</span>, <span class="number">100</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="number">5000</span>, <span class="number">10000</span>, <span class="number">50000</span>, <span class="number">100000</span>)</div><div class="line">ts &lt;- c(<span class="number">10000</span>, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)</div><div class="line"></div><div class="line">tCpp &lt;- ns</div><div class="line">tR1 &lt;- ns</div><div class="line">tR2 &lt;- ns</div><div class="line"></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:length(ns)) &#123;</div><div class="line">  x &lt;- seq(<span class="number">0</span>, <span class="number">1</span>, length.out = ns[i])</div><div class="line">  u &lt;- nrntInput(x)</div><div class="line"></div><div class="line">  rCpp &lt;- microbenchmark(minModRec(x, u), times = ts[i])</div><div class="line">  tCpp[i] &lt;- median(rCpp$time) / <span class="number">1000</span></div><div class="line">  rR1 &lt;- microbenchmark(RminModRec(x, u), times = ts[i])</div><div class="line">  tR1[i] &lt;- median(rR1$time) / <span class="number">1000</span></div><div class="line">  rR2 &lt;- microbenchmark(RminModRec2(x, u), times = ts[i])</div><div class="line">  tR2[i] &lt;- median(rR2$time) / <span class="number">1000</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We will also use the data from an externally run Fortran implementation with the same parameters. The results are like this: <img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-14-1.png" alt=""></p>
<p>Relative to C++: <img src="/testMinModRec_files/figure-markdown_github/unnamed-chunk-15-1.png" alt=""></p>
<h1 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions:"></a>Conclusions:</h1><ul>
<li>C++ is much faster than R and, at least in this test, comparable in speed to Fortran (generally a bit worse)</li>
<li>Avoid using ifelse in R</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2017/08/08/R-versus-C-and-Fortran/" data-id="cj98cn4h3000474srjllofzjc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Making-nice-1D-plots-using-ggplot-with-little-effort" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/07/Making-nice-1D-plots-using-ggplot-with-little-effort/" class="article-date">
  <time datetime="2016-12-07T17:00:21.000Z" itemprop="datePublished">2016-12-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/07/Making-nice-1D-plots-using-ggplot-with-little-effort/">Making nice 1D plots using ggplot with little effort</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is an R subroutine that makes it possible to make quality plots with a minimal learning curve. You do not need to learn all the ggplot2 options (right away) to produce nice figures. At the end of this document there is a full example.</p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>You need to install the following packages: ggplot2. If you plan to use plotimggg to convolve the arrays, you also need to install spatialfil.</p>
<p>A reminder: to install these packages, you can run the following code:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"ggplot2"</span>)</div></pre></td></tr></table></figure>
<h2 id="Including-the-plotting-routine"><a href="#Including-the-plotting-routine" class="headerlink" title="Including the plotting routine"></a>Including the plotting routine</h2><p>For the time being the plotting routine is not an R package, but rather it should be included using the source function. The file can be found here: <a href="https://github.com/petarmimica/pltptsgg/blob/master/pltptsgg.R" target="_blank" rel="external">pltptsgg.R</a>. Put the file somewhere (in your working directory, for example) and include it:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span>(<span class="string">"pltptsgg.R"</span>)</div></pre></td></tr></table></figure>
<h2 id="1D-plots"><a href="#1D-plots" class="headerlink" title="1D plots"></a>1D plots</h2><h3 id="Basic-usage"><a href="#Basic-usage" class="headerlink" title="Basic usage"></a>Basic usage</h3><p>The idea is that we have one or more data series and wish to display them. Let us start with the simplest case of just one series:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># generate x</span></div><div class="line">x &lt;- seq(from = <span class="number">1</span>, to = <span class="number">10</span>, by = <span class="number">0.5</span>)</div><div class="line"></div><div class="line"><span class="comment"># compute y from x</span></div><div class="line">y &lt;- x^<span class="number">2</span></div></pre></td></tr></table></figure>
<p>To plot using pltptsgg.plot1D routine, we need to prepare the data. Since we wish to be able to plot multiple datasets, each with possibly different number of elements, pltptsgg provides two routines to convert the raw data into something pltptsgg.plot1D can easily use. First, we need to create a data frame, either manually or using pltptsgg.get.curve:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.curve &lt;- pltptsgg.get.curve(x, y)</div></pre></td></tr></table></figure>
<p>The returned variable is a two-variable data frame (a two-column table), containing the “x” and “y” columns:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str(data.curve)</div></pre></td></tr></table></figure>
<pre><code>## &apos;data.frame&apos;:    19 obs. of  2 variables:
##  $ x: num  1 1.5 2 2.5 3 3.5 4 4.5 5 5.5 ...
##  $ y: num  1 2.25 4 6.25 9 ...
</code></pre><p>If we were plotting more than one series, we would create curves for each of them and then use pltptsgg.get.data to create a single list. In this case we use the only curve we have:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># create the list</span></div><div class="line">data.list &lt;- pltptsgg.get.data(list(data.curve))</div><div class="line"></div><div class="line"><span class="comment"># get information about the list</span></div><div class="line">str(data.list)</div></pre></td></tr></table></figure>
<pre><code>## List of 1
##  $ curve01:&apos;data.frame&apos;: 19 obs. of  2 variables:
##   ..$ x: num [1:19] 1 1.5 2 2.5 3 3.5 4 4.5 5 5.5 ...
##   ..$ y: num [1:19] 1 2.25 4 6.25 9 ...
</code></pre><p>Note that pltptsgg.get.data return a list of an arbitrary number of data frames, and each data frame contains only two columns named “x” and “y”. You can use your own list instead of the one prepared by the routine, as long as the list is in this format.</p>
<p>Now we can call the plotting routine:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(data.list)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-7-1.png" alt=""></p>
<p>This is the default plot. If you wish to avoid storing the intermediate results, you can inline the other functions into the pltptsgg.plot1D call:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y))))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-8-1.png" alt=""></p>
<h4 id="Plotting-two-series"><a href="#Plotting-two-series" class="headerlink" title="Plotting two series"></a>Plotting two series</h4><p>Let’s add another series to our plot:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># generate a new series</span></div><div class="line">x2 &lt;- c(<span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>)</div><div class="line">y2 &lt;- c(<span class="number">2</span>, <span class="number">16</span>, <span class="number">75</span>)</div><div class="line"></div><div class="line"><span class="comment"># generate curves</span></div><div class="line">data.curve1 &lt;- pltptsgg.get.curve(x, y)</div><div class="line">data.curve2 &lt;- pltptsgg.get.curve(x2, y2)</div><div class="line"></div><div class="line"><span class="comment"># generate data list</span></div><div class="line">data.list &lt;- pltptsgg.get.data(list(data.curve1, data.curve2))</div><div class="line"></div><div class="line"><span class="comment"># plot</span></div><div class="line">pltptsgg.plot1D(data.list)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-9-1.png" alt=""></p>
<p>As before, we can use a single call to plot everything:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-10-1.png" alt=""></p>
<p>Note that pltptsgg.get.data accepts a list of data frames as an argument. If you already have a data frame and it contains columns calles “x” and “y”, you can pass it directly to pltptsgg.get.data.</p>
<h4 id="Plotting-points-instead-of-lines"><a href="#Plotting-points-instead-of-lines" class="headerlink" title="Plotting points instead of lines"></a>Plotting points instead of lines</h4><p>By default the lines are connecting the points. If we wish to plot some of the series as points, we can indicate it via the points logicalvector:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), points=c(<span class="literal">FALSE</span>, <span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-11-1.png" alt=""></p>
<p>We can also change the shape type by passing the shapes vector:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), points=c(<span class="literal">FALSE</span>, <span class="literal">TRUE</span>), shapes=c(<span class="number">0</span>, <span class="number">1</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-12-1.png" alt=""></p>
<p>Note that the first element of shapes is ignored since we are plotting lines.</p>
<h4 id="Changing-the-line-type-width-and-colour"><a href="#Changing-the-line-type-width-and-colour" class="headerlink" title="Changing the line type, width and colour"></a>Changing the line type, width and colour</h4><p>We can change the linetypes by using the linetypes keyword:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), linetypes=c(<span class="number">2</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-13-1.png" alt=""></p>
<p>To change the width use linesizes:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), linesizes=c(<span class="number">2</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-14-1.png" alt=""></p>
<p>Similarly, the colours keyword changes colours:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), colours=c(<span class="string">"red"</span>, <span class="string">"yellow"</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-15-1.png" alt=""></p>
<h3 id="Adjusting-legends"><a href="#Adjusting-legends" class="headerlink" title="Adjusting legends"></a>Adjusting legends</h3><p>By default, the routine labels the curves automatically: “curve01”, “curve02”, etc. We can adjust this by using labels keyword:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), labels=c(<span class="string">"Quantity 1"</span>, <span class="string">"Quantity 2"</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-16-1.png" alt=""></p>
<p>The legend title can be changed using the legend.name keyword:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), labels=c(<span class="string">"Quantity 1"</span>, <span class="string">"Quantity 2"</span>), legend.name = <span class="string">"Quantities shown"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-17-1.png" alt=""></p>
<h3 id="Adjusting-axes"><a href="#Adjusting-axes" class="headerlink" title="Adjusting axes"></a>Adjusting axes</h3><p>Often the axes generated by ggplot2 are good enough. Nevertheless, pltptsgg.plot1D provides a number of keywords which can be used to adjust them.</p>
<h4 id="Axis-labels"><a href="#Axis-labels" class="headerlink" title="Axis labels"></a>Axis labels</h4><p>To change axis labels, use xlab and ylab keywords:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xlab=<span class="string">"time"</span>, ylab=<span class="string">"space"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-18-1.png" alt=""></p>
<h4 id="Axis-limits"><a href="#Axis-limits" class="headerlink" title="Axis limits"></a>Axis limits</h4><p>The limits can be changed using xlim and ylim keywords:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xlim=c(<span class="number">1</span>, <span class="number">100</span>), ylim=c(-<span class="number">100</span>, <span class="number">100</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-19-1.png" alt=""></p>
<h4 id="Axis-scale"><a href="#Axis-scale" class="headerlink" title="Axis scale"></a>Axis scale</h4><p>The scale can be changed to logarithmic using xlog and ylog keywords:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-20-1.png" alt=""></p>
<p>In order to obtain a more traditional logarithmic plot, with minor grid lines denoting the intermediate values use major.xticks = 10 and major.yticks = 10 (see below for the explanation of these keywords):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, major.xticks = <span class="number">10</span>, major.yticks = <span class="number">10</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-21-1.png" alt=""></p>
<h4 id="Axis-number-format"><a href="#Axis-number-format" class="headerlink" title="Axis number format"></a>Axis number format</h4><p>Keeping the logarithmic plot example, we may wish to change the number format to powers of 10:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, major.xticks = <span class="number">10</span>, major.yticks = <span class="number">10</span>, xformat = <span class="string">"pow"</span>, yformat = <span class="string">"pow"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-22-1.png" alt=""></p>
<p>Another option, apart from the defualt one, is the scientific. Reverting to the linear scale for this example:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xformat = <span class="string">"sci"</span>, yformat = <span class="string">"sci"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-23-1.png" alt=""></p>
<p>The number of digits in this format can be changed using xdigits and ydigits keywords:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), xformat = <span class="string">"sci"</span>, yformat = <span class="string">"sci"</span>, xdigits = <span class="number">2</span>, ydigits = <span class="number">6</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-24-1.png" alt=""></p>
<h4 id="Axis-ticks"><a href="#Axis-ticks" class="headerlink" title="Axis ticks"></a>Axis ticks</h4><p>We can also change the spacing of the major and minor ticks. For example, we can set the major ticks (the points where numbers will appear) to be multiples of 5 for the x axis and multiples of 50 for the y axis using major.xticks and major.yticks:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">5</span>, major.yticks = <span class="number">50</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-25-1.png" alt=""></p>
<p>To set the spacing of the intermediate lines we can use minor.xticks and minor.yticks. Let’s add them every 1 unit in x and every 10 units in y:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">5</span>, major.yticks = <span class="number">50</span>, minor.xticks = <span class="number">1</span>, minor.yticks = <span class="number">10</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-26-1.png" alt=""></p>
<p>For the logarithmic plots it is recommended to use a power of 10 for major ticks and to set minor ticks to 1 (or to omit that keyword, since 1 is the default value). Here are few examples. The “standard” case:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">10</span>, major.yticks = <span class="number">10</span>, xlim=c(<span class="number">0.9</span>, <span class="number">1001</span>), ylim = c(<span class="number">0.9</span>, <span class="number">1001</span>), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, xformat=<span class="string">"pow"</span>, yformat=<span class="string">"pow"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-27-1.png" alt=""></p>
<p>Plotting every 100 instead of 10:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">100</span>, major.yticks = <span class="number">100</span>, xlim=c(<span class="number">0.9</span>, <span class="number">1001</span>), ylim = c(<span class="number">0.9</span>, <span class="number">1001</span>), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, xformat=<span class="string">"pow"</span>, yformat=<span class="string">"pow"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-28-1.png" alt=""></p>
<p>Changing the number of minor ticks:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">10</span>, major.yticks = <span class="number">10</span>, xlim=c(<span class="number">0.9</span>, <span class="number">1001</span>), ylim = c(<span class="number">0.9</span>, <span class="number">1001</span>), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, xformat=<span class="string">"pow"</span>, yformat=<span class="string">"pow"</span>, minor.xticks = <span class="number">2</span>, minor.yticks = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-29-1.png" alt=""></p>
<h3 id="Disabling-grid"><a href="#Disabling-grid" class="headerlink" title="Disabling grid"></a>Disabling grid</h3><p>By default, ggplot2 plots a grid, but it can be disabled by setting grid = FALSE. This is my preferred option:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), grid = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-30-1.png" alt=""></p>
<p>The logarithmic plot also looks nice without a grid:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), major.xticks = <span class="number">10</span>, major.yticks = <span class="number">10</span>, xlim=c(<span class="number">0.9</span>, <span class="number">1001</span>), ylim = c(<span class="number">0.9</span>, <span class="number">1001</span>), xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>, xformat=<span class="string">"pow"</span>, yformat=<span class="string">"pow"</span>, grid=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-31-1.png" alt=""></p>
<h3 id="Using-custom-theme"><a href="#Using-custom-theme" class="headerlink" title="Using custom theme"></a>Using custom theme</h3><p>If you have your own preferred theme, you can replace the one used by pltptsgg.plot1D by using the theme keyword. This sets the theme to theme_classic():</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(pltptsgg.get.curve(x, y), pltptsgg.get.curve(x2, y2))), theme = theme_classic())</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-32-1.png" alt=""></p>
<h2 id="Full-example"><a href="#Full-example" class="headerlink" title="Full example"></a>Full example</h2><p>This is a full documented example that you can copy and adapt to your needs. It uses the Cars93 built-in dataset plots miles per gallon in the city and on the highway as a function of car price.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># load plotting libraries and routines</span></div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">source</span>(<span class="string">"pltptsgg.R"</span>)</div><div class="line"></div><div class="line"><span class="comment"># use built-in MASS library</span></div><div class="line"><span class="keyword">library</span>(MASS)</div><div class="line"></div><div class="line"><span class="comment"># create the data curves</span></div><div class="line">city.curve &lt;- pltptsgg.get.curve(Cars93$Price * <span class="number">1000</span>, Cars93$MPG.city)</div><div class="line">highway.curve &lt;- pltptsgg.get.curve(Cars93$Price * <span class="number">1000</span>, Cars93$MPG.highway)</div><div class="line"></div><div class="line"><span class="comment"># create the data list</span></div><div class="line">data.list &lt;- pltptsgg.get.data(list(city.curve, highway.curve))</div><div class="line"></div><div class="line"><span class="comment"># plot</span></div><div class="line">pltptsgg.plot1D(data.list, xlab=<span class="string">"Price (USD)"</span>, ylab = <span class="string">"Miles per gallon"</span>, labels = c(<span class="string">"City"</span>, <span class="string">"Highway"</span>), legend.name = <span class="string">"Driving location"</span>, grid=<span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-33-1.png" alt=""></p>
<h2 id="Advanced-plotting"><a href="#Advanced-plotting" class="headerlink" title="Advanced plotting"></a>Advanced plotting</h2><h3 id="Errorbars"><a href="#Errorbars" class="headerlink" title="Errorbars"></a>Errorbars</h3><p>It is possible to specify both horizontal and vertical errorbars. Let us go back to our original dataset and add random errors to x and y:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># generate x</span></div><div class="line">x &lt;- seq(from = <span class="number">1</span>, to = <span class="number">10</span>, by = <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># compute y from x</span></div><div class="line">y &lt;- x^<span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># add errors</span></div><div class="line">xerr &lt;- runif(length(x), min = -<span class="number">1</span>, max = <span class="number">1</span>)</div><div class="line">yerr &lt;- runif(length(y), min = -<span class="number">8</span>, max = <span class="number">8</span>)</div></pre></td></tr></table></figure>
<p>Now we can use pltptsgg.get.curve to generate a dataset including errors:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.curve &lt;- pltptsgg.get.curve(x, y, xerr = xerr, yerr = yerr)</div></pre></td></tr></table></figure>
<p>Then we call the plotting routine as usual (here plotted with points instead of lines):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(data.curve)), point=c(<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-36-1.png" alt=""></p>
<p>We can change the length of the errorbars using errorbar.width and errorbar.height keywords:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(data.curve)), point=c(<span class="literal">TRUE</span>), errorbar.width = <span class="number">2</span>, errorbar.height = <span class="number">10</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-37-1.png" alt=""></p>
<p>Typically only vertical errorbars are present:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.curve &lt;- pltptsgg.get.curve(x, y, yerr = yerr)</div><div class="line">pltptsgg.plot1D(pltptsgg.get.data(list(data.curve)), point=c(<span class="literal">TRUE</span>))</div></pre></td></tr></table></figure>
<p><img src="/pltptsgg_files/figure-markdown_github/unnamed-chunk-38-1.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2016/12/07/Making-nice-1D-plots-using-ggplot-with-little-effort/" data-id="cj98cn4h2000374sr2xa6ue3n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Avoid-unwanted-polygon-borders-in-ggplot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/01/Avoid-unwanted-polygon-borders-in-ggplot/" class="article-date">
  <time datetime="2016-12-01T18:00:00.000Z" itemprop="datePublished">2016-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/01/Avoid-unwanted-polygon-borders-in-ggplot/">Avoid unwanted polygon borders in ggplot</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What-is-the-problem"><a href="#What-is-the-problem" class="headerlink" title="What is the problem?"></a>What is the problem?</h2><p>(I used R 3.3.2, RStudio 1.0.44 and ggplot2 2.2.0 for this post).</p>
<p>I really like <a href="http://ggplot2.org/" target="_blank" rel="external">ggplot2</a> for making quality graphics in R. You can check <a href="pltimggg.html">my first post</a> to see what can be done to improve 2D image representation. However, while developing the code that plots data in spherical geometry I run against a problem with polygon borders being shown even when I wanted to avoid it.</p>
<h2 id="ggplot2’s-geom-polygon-command"><a href="#ggplot2’s-geom-polygon-command" class="headerlink" title="ggplot2’s geom_polygon command"></a>ggplot2’s geom_polygon command</h2><p>In order to draw filled polygons in ggplot2 we have to provide a data frame that contains the polygon vertices and the values that are going to be used to fill it with colour. Let’s start with an example:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># include the ggplot2 package</span></div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"></div><div class="line"><span class="comment"># declare the vectors containing the coordinates of the corners of four polygons.</span></div><div class="line">x.bottom.left &lt;- c(-<span class="number">1</span>, -<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.5</span>)</div><div class="line">x.bottom.right&lt;- c( <span class="number">0</span>,  <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">1.5</span>)</div><div class="line">x.top.left    &lt;- c(-<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1</span>)</div><div class="line">x.top.right   &lt;- c( <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">1.5</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line">y.bottom.left &lt;- c(-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>)</div><div class="line">y.bottom.right&lt;- c(-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>)</div><div class="line">y.top.left    &lt;- c( <span class="number">0</span>, <span class="number">1</span>,  <span class="number">0</span>, <span class="number">1</span>)</div><div class="line">y.top.right   &lt;- c( <span class="number">0</span>, <span class="number">1</span>,  <span class="number">0</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># declare a vector of values</span></div><div class="line">values &lt;- c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="comment"># create a data frame containing values and ids</span></div><div class="line">values.df &lt;- data.frame(value = values, id = c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</div><div class="line"></div><div class="line"><span class="comment"># create the x and y vectors containing the coordinates of each polygon in the correct order</span></div><div class="line">x.coords &lt;- unlist(lapply(<span class="number">1</span>:length(x.bottom.left), <span class="keyword">function</span>(i) &#123;</div><div class="line">    c(x.bottom.left[i], x.bottom.right[i], x.top.right[i], x.top.left[i])</div><div class="line">&#125;))</div><div class="line"></div><div class="line">y.coords &lt;- unlist(lapply(<span class="number">1</span>:length(y.bottom.left), <span class="keyword">function</span>(i) &#123;</div><div class="line">    c(y.bottom.left[i], y.bottom.right[i], y.top.right[i], y.top.left[i])</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="comment"># create a coordinates data frame</span></div><div class="line">coords.df &lt;- data.frame(id = rep(c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>), each = <span class="number">4</span>), x = x.coords, y = y.coords)</div><div class="line"></div><div class="line"><span class="comment"># merge the data frames</span></div><div class="line">data.df &lt;- merge(values.df, coords.df, by = c(<span class="string">"id"</span>))</div><div class="line"></div><div class="line"><span class="comment"># plot</span></div><div class="line">ggplot(data = data.df, aes(x = x, y = y)) + geom_polygon(aes(fill = value, group = id), color=<span class="literal">NA</span>) + theme_classic()</div></pre></td></tr></table></figure>
<p><img src="/polygon_files/figure-markdown_github/unnamed-chunk-1-1.png" alt=""></p>
<p>On my Mac there is an annoying white line around each polygon. It gets worse if the number of polygons increases. Let’s automate the coordinates creation routine and plot</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># we want to plot a grid of 100 by 100 polygons</span></div><div class="line">num.x &lt;- <span class="number">100</span></div><div class="line">num.y &lt;- <span class="number">100</span></div><div class="line"></div><div class="line">x.bottom.left &lt;- rep(<span class="number">1e0</span>, num.x * num.y)</div><div class="line">y.bottom.left &lt;- x.bottom.left</div><div class="line"></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:num.x) &#123;</div><div class="line">    <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:num.y) &#123;</div><div class="line"> </div><div class="line">        x.bottom.left[(i - <span class="number">1</span>) * num.y + j] &lt;- -<span class="number">1</span> + <span class="number">2</span> * (i - <span class="number">1</span>) / num.x + <span class="number">1</span> * (j - <span class="number">1</span>) / num.y        </div><div class="line">        y.bottom.left[(i - <span class="number">1</span>) * num.y + j] &lt;- -<span class="number">1</span> + <span class="number">2</span> * (j - <span class="number">1</span>) / num.y          </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">x.bottom.right &lt;- x.bottom.left + <span class="number">2</span> / num.x</div><div class="line">x.top.left &lt;- x.bottom.left + <span class="number">1</span> / num.y</div><div class="line">x.top.right &lt;- x.top.left + <span class="number">2</span> / num.x</div><div class="line">y.bottom.right &lt;- y.bottom.left</div><div class="line">y.top.left &lt;- y.bottom.left + <span class="number">2</span> / num.y</div><div class="line">y.top.right &lt;- y.bottom.right + <span class="number">2</span> / num.y</div><div class="line"></div><div class="line"><span class="comment"># declare a vector of values</span></div><div class="line">values &lt;- seq(<span class="number">1</span>:(num.x * num.y))</div><div class="line"></div><div class="line"><span class="comment"># create a data frame containing values and ids</span></div><div class="line">values.df &lt;- data.frame(value = values, id = seq(<span class="number">1</span>:(num.x*num.y)))</div><div class="line"></div><div class="line"><span class="comment"># create the x and y vectors containing the coordinates of each polygon in the correct order</span></div><div class="line">x.coords &lt;- unlist(lapply(<span class="number">1</span>:length(x.bottom.left), <span class="keyword">function</span>(i) &#123;</div><div class="line">    c(x.bottom.left[i], x.bottom.right[i], x.top.right[i], x.top.left[i])</div><div class="line">&#125;))</div><div class="line"></div><div class="line">y.coords &lt;- unlist(lapply(<span class="number">1</span>:length(y.bottom.left), <span class="keyword">function</span>(i) &#123;</div><div class="line">    c(y.bottom.left[i], y.bottom.right[i], y.top.right[i], y.top.left[i])</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="comment"># create a coordinates data frame</span></div><div class="line">coords.df &lt;- data.frame(id = rep(seq(<span class="number">1</span>:(num.x*num.y)), each = <span class="number">4</span>), x = x.coords, y = y.coords)</div><div class="line"></div><div class="line"><span class="comment"># merge the data frames</span></div><div class="line">data.df &lt;- merge(values.df, coords.df, by = c(<span class="string">"id"</span>))</div><div class="line"></div><div class="line"><span class="comment"># plot</span></div><div class="line">ggplot(data = data.df, aes(x = x, y = y)) + geom_polygon(aes(fill = value, group = id), color=<span class="literal">NA</span>, linetype=<span class="number">0</span>, lwd = <span class="number">0</span>) + theme_classic()</div></pre></td></tr></table></figure>
<p><img src="/polygon_files/figure-markdown_github/unnamed-chunk-2-1.png" alt=""></p>
<p>It looks pretty bad, the borders are covering the polygons. And this happens even though we set the line type to 0 (none) and its width to 0 as well!</p>
<p>The solution seems to be very simple, as it turns out:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data = data.df, aes(x = x, y = y, group = id)) + geom_polygon(aes(fill = value, color=value)) + theme_classic() + scale_fill_continuous() + scale_colour_continuous()</div></pre></td></tr></table></figure>
<p><img src="/polygon_files/figure-markdown_github/unnamed-chunk-3-1.png" alt=""></p>
<p>Note that now fill and colour are inside the aesthetic of the geom_polygon, and also that the scales for the colors and filling are the same (and should be the same). Here is a variant with gradients:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(data = data.df, aes(x = x, y = y, group = id)) + geom_polygon(aes(fill = value, color=value)) + theme_classic() + scale_fill_gradient(low=<span class="string">"red"</span>, high=<span class="string">"green"</span>) + scale_colour_gradient(low=<span class="string">"red"</span>, high=<span class="string">"green"</span>)</div></pre></td></tr></table></figure>
<p><img src="/polygon_files/figure-markdown_github/unnamed-chunk-4-1.png" alt=""></p>
<p>This seems to solve the problem. Just make sure to use exactly the same colour palette in both scale_fill and scale_colour.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2016/12/01/Avoid-unwanted-polygon-borders-in-ggplot/" data-id="cj98cn4gs000074srxh9rcajy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Making-nice-2D-plots-using-ggplot-with-little-effort" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/01/Making-nice-2D-plots-using-ggplot-with-little-effort/" class="article-date">
  <time datetime="2016-12-01T17:17:42.000Z" itemprop="datePublished">2016-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/01/Making-nice-2D-plots-using-ggplot-with-little-effort/">Making nice 2D plots using ggplot with little effort</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>You need to install the following packages: ggplot2, reshape2 and RColorBrewer. If you plan to use plotimggg to convolve the arrays, you also need to install spatialfil.</p>
<p>A reminder: to install these packages, you can run the following code:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">install.packages(<span class="string">"ggplot2"</span>)</div><div class="line">install.packages(<span class="string">"reshape2"</span>)</div><div class="line">install.packages(<span class="string">"RColorBrewer"</span>)</div><div class="line">install.packages(<span class="string">"spatialfil"</span>)</div></pre></td></tr></table></figure>
<h2 id="Including-the-plotting-routine"><a href="#Including-the-plotting-routine" class="headerlink" title="Including the plotting routine"></a>Including the plotting routine</h2><p>For the time being the plotting routine is not an R package, but rather it should be included using the source function. The file can be found here: <a href="https://github.com/petarmimica/pltimggg/blob/master/pltimggg.R" target="_blank" rel="external">pltimggg.R</a>. Put the file somewhere (in your working directory, for example) and include it:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span>(<span class="string">"pltimggg.R"</span>)</div></pre></td></tr></table></figure>
<h2 id="2D-plots"><a href="#2D-plots" class="headerlink" title="2D plots"></a>2D plots</h2><h3 id="Basic-usage"><a href="#Basic-usage" class="headerlink" title="Basic usage"></a>Basic usage</h3><p>For it to make any sense to use pltimggg, you need to have a 2D array and the corresponding vectors corresponding to each axis. In this example we will generate a 100x100 array with axes spanning the interval [1, 11].</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># define array dimensions</span></div><div class="line">nx &lt;- <span class="number">100</span></div><div class="line">ny &lt;- <span class="number">100</span></div><div class="line"></div><div class="line"><span class="comment"># axes limits</span></div><div class="line">xlim = c(<span class="number">1e0</span>, <span class="number">11e0</span>)</div><div class="line">ylim = c(<span class="number">1e0</span>, <span class="number">11e0</span>)</div><div class="line"></div><div class="line"><span class="comment"># compute axes</span></div><div class="line">x &lt;- (<span class="number">0</span> : (nx - <span class="number">1</span>)) * (xlim[<span class="number">2</span>] - xlim[<span class="number">1</span>]) / (nx - <span class="number">1</span>) + xlim[<span class="number">1</span>]</div><div class="line">y &lt;- (<span class="number">0</span> : (ny - <span class="number">1</span>)) * (ylim[<span class="number">2</span>] - ylim[<span class="number">1</span>]) / (ny - <span class="number">1</span>) + ylim[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># declare array</span></div><div class="line">img &lt;- array(<span class="number">1e0</span>, c(nx, ny))</div><div class="line"></div><div class="line"><span class="comment"># fill array with random numbers in a certain interval</span></div><div class="line">img &lt;- <span class="number">10</span>^(apply(img, c(<span class="number">1</span>, <span class="number">2</span>), <span class="keyword">function</span>(x) &#123;rnorm(<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">0.3</span>) &#125;) * <span class="number">2e0</span>) * <span class="number">1e-15</span></div></pre></td></tr></table></figure>
<p>Now we can try to plot the image using the default settings:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-4-1.png" alt=""></p>
<h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><p>Now we review the parameters that can be passed to pltimggg.plot2D.</p>
<h4 id="zlog-logarithmic-scale-for-the-values-default-zlog-FALSE"><a href="#zlog-logarithmic-scale-for-the-values-default-zlog-FALSE" class="headerlink" title="zlog: logarithmic scale for the values, default zlog = FALSE"></a>zlog: logarithmic scale for the values, default zlog = FALSE</h4><p>To plot the image in logarithmic scale set zlog to TRUE:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-5-1.png" alt=""></p>
<h4 id="legend-direction-colourbar-direction-default-legend-direction-“horizontal”"><a href="#legend-direction-colourbar-direction-default-legend-direction-“horizontal”" class="headerlink" title="legend.direction: colourbar direction, default legend.direction = “horizontal”"></a>legend.direction: colourbar direction, default legend.direction = “horizontal”</h4><p>To plot the colourbar on the right set legend.direction to “vertical”:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-6-1.png" alt=""></p>
<h4 id="xlab-ylab-and-zlab-axes-and-colourbar-labels-default-“x”-“y”-and-“z”-respectively"><a href="#xlab-ylab-and-zlab-axes-and-colourbar-labels-default-“x”-“y”-and-“z”-respectively" class="headerlink" title="xlab, ylab and zlab: axes and colourbar labels, default: “x”, “y” and “z”, respectively"></a>xlab, ylab and zlab: axes and colourbar labels, default: “x”, “y” and “z”, respectively</h4><p>The labels of the axes and the colourbar can be changed by giving the appropriate values to xlab, ylab and zlab:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, xlab=<span class="string">"x (degrees)"</span>, ylab=<span class="string">"y (degrees)"</span>, zlab=expression(paste(<span class="string">"intensity ["</span>~<span class="string">"erg"</span>~<span class="string">"s"</span>^<span class="string">"-1"</span>~<span class="string">"cm"</span>^<span class="string">"-2"</span>~<span class="string">"arcmin"</span>^<span class="string">"-2"</span>~<span class="string">"]"</span>)))</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-7-1.png" alt=""></p>
<h4 id="xlog-ylog-logarithmic-scaling-of-the-coordinate-axes-default-FALSE"><a href="#xlog-ylog-logarithmic-scaling-of-the-coordinate-axes-default-FALSE" class="headerlink" title="xlog, ylog: logarithmic scaling of the coordinate axes, default: FALSE"></a>xlog, ylog: logarithmic scaling of the coordinate axes, default: FALSE</h4><p>We can also plot in the logarithmic scale by setting xlog and/or ylog to TRUE.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, xlog = <span class="literal">TRUE</span>, ylog = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-8-1.png" alt=""></p>
<h4 id="zlinformat-colourscale-values-format-default-zlinformat-FALSE"><a href="#zlinformat-colourscale-values-format-default-zlinformat-FALSE" class="headerlink" title="zlinformat: colourscale values format, default zlinformat = FALSE"></a>zlinformat: colourscale values format, default zlinformat = FALSE</h4><p>When the image is plotted in logarithmic scale, by default the colourbar values are printed as powers of ten. If we want them to be printed in the scientific notation we set zlinformat to TRUE:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, zlinformat=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-9-1.png" alt=""></p>
<h4 id="xlinformat-ylinformat-axes-values-format-default-FALSE"><a href="#xlinformat-ylinformat-axes-values-format-default-FALSE" class="headerlink" title="xlinformat, ylinformat: axes values format, default FALSE"></a>xlinformat, ylinformat: axes values format, default FALSE</h4><p>Similar to zlinformat, but for axes. By default nothing special is done with the axes, but it can be changed:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, xlinformat=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-10-1.png" alt=""></p>
<h4 id="xdigits-ydigits-and-zdigits-number-of-digits-in-the-scientific-notation-for-the-colourbar-default-1"><a href="#xdigits-ydigits-and-zdigits-number-of-digits-in-the-scientific-notation-for-the-colourbar-default-1" class="headerlink" title="xdigits, ydigits and zdigits: number of digits in the scientific notation for the colourbar, default 1"></a>xdigits, ydigits and zdigits: number of digits in the scientific notation for the colourbar, default 1</h4><p>By default only one digit is printed in the scientific notation. To use 2 set xdigits, ydigits or zdigits to 2 (note that this only has an effect when xlinformat, ylinformat or zlinformat = TRUE or when plotting in a linear scale [xlog, ylog or zlog = FALSE]):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, zlinformat=<span class="literal">TRUE</span>, zdigits = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-11-1.png" alt=""></p>
<p>The parameter has no effect when the powers of ten are used:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, zdigits = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-12-1.png" alt=""></p>
<p>An example with the x-axis:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, xdigits = <span class="number">2</span>, xlinformat = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-13-1.png" alt=""></p>
<h4 id="aspect-preserve-aspect-ratio-default-aspect-TRUE"><a href="#aspect-preserve-aspect-ratio-default-aspect-TRUE" class="headerlink" title="aspect: preserve aspect ratio, default aspect = TRUE"></a>aspect: preserve aspect ratio, default aspect = TRUE</h4><p>By default, the coordinates have an equal length scale in x and y directions. This can cause problems in semilogarithmic plots:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, xlog = <span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-14-1.png" alt=""></p>
<p>A remedy is to set aspect to FALSE:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, xlog = <span class="literal">TRUE</span>, aspect = <span class="literal">FALSE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-15-1.png" alt=""></p>
<h4 id="zbarwidth-and-zbarheight-colourbar-width-and-height-default-zbarwidth-20-zbarheight-1"><a href="#zbarwidth-and-zbarheight-colourbar-width-and-height-default-zbarwidth-20-zbarheight-1" class="headerlink" title="zbarwidth and zbarheight: colourbar width and height, default: zbarwidth = 20, zbarheight = 1"></a>zbarwidth and zbarheight: colourbar width and height, default: zbarwidth = 20, zbarheight = 1</h4><p>By default the colourbar is horizontal, its length is 20 (zbarwidth = 20) and its thickness is 1 (zbarheight = 1). If legend.direction is set to “vertical” these values are interchanged by the routine itself.</p>
<p>To make the horizontal colourbar longer and thicker set zbarwidth to 25 and zbarheight to 2:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, zbarwidth=<span class="number">25</span>, zbarheight = <span class="number">2</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-16-1.png" alt=""></p>
<p>For the vertical bar remember that zbarwidth and zbarheight have the opposite meaning than in the horizontal case. To reduce the length and thickness set zbarheight to 18 and zbarwidth to 0.5:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, zbarheight = <span class="number">18</span>, zbarwidth = <span class="number">0.5</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-17-1.png" alt=""></p>
<h4 id="ztitleposition-colourbar-title-position-default-ztitleposition-“top”"><a href="#ztitleposition-colourbar-title-position-default-ztitleposition-“top”" class="headerlink" title="ztitleposition: colourbar title position, default ztitleposition = “top”"></a>ztitleposition: colourbar title position, default ztitleposition = “top”</h4><p>By default, the position of the colourbar title is above the colourbar in the horizontal case and to the right in the vertical case. To plot the title below the vertical colourbar set ztitleposition to “bottom”:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, ztitleposition = <span class="string">"bottom"</span>, zlab=<span class="string">"values"</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-18-1.png" alt=""></p>
<p>Note that the title is rotated by 90 degrees, which is not something we may necessarily want here. The next parameter can help.</p>
<h4 id="zitleorientation-colourbar-title-orientation-angle-default-ztitleorientation-0"><a href="#zitleorientation-colourbar-title-orientation-angle-default-ztitleorientation-0" class="headerlink" title="zitleorientation: colourbar title orientation angle, default ztitleorientation = 0"></a>zitleorientation: colourbar title orientation angle, default ztitleorientation = 0</h4><p>By default, the title is printed horizonally (ztitleorientation = 0) when the colourbar is horizontal, and vertically (ztitleorientation = 90) when it is vertical (this is automatically changed by the routine when legend.direction is set to “vertical”). In the previous example we may want to print the title horizontally and set ztitleorientation to 0:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, ztitleposition = <span class="string">"bottom"</span>, zlab=<span class="string">"values"</span>, ztitleorientation = <span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-19-1.png" alt=""></p>
<h4 id="ztitlehjust-and-ztitlevjust-title-horizontal-and-vertical-justification-default-0-5-both"><a href="#ztitlehjust-and-ztitlevjust-title-horizontal-and-vertical-justification-default-0-5-both" class="headerlink" title="ztitlehjust and ztitlevjust: title horizontal and vertical justification, default: 0.5 both"></a>ztitlehjust and ztitlevjust: title horizontal and vertical justification, default: 0.5 both</h4><p>By default, the title is centered both horizontally and vertically (ztitlehjust = 0.5 and ztitlevjust = 0.5). To justify left (bottom), set ztitlehjust the value to 0, and for the right (right and top) justification set it to 1.</p>
<p>Move the title to the bottom:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, zlab=<span class="string">"values"</span>, ztitlehjust = <span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-20-1.png" alt=""></p>
<p>Move the title to the right:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, zlab=<span class="string">"values"</span>, ztitlehjust = <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-21-1.png" alt=""></p>
<h4 id="colours-colourscale-to-be-used-default-internally-defined-rainbow"><a href="#colours-colourscale-to-be-used-default-internally-defined-rainbow" class="headerlink" title="colours: colourscale to be used, default: internally defined rainbow"></a>colours: colourscale to be used, default: internally defined rainbow</h4><p>There is a rainbow colourscale defined internally. You can replace it by your own colourscale. For example, to use grayscale you first generate the colours useing e.g. colorRampPalette and then pass the result to plotimggg.plot2D:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">myPalette &lt;- colorRampPalette(c(<span class="string">"black"</span>, <span class="string">"white"</span>))(<span class="number">100</span>)</div><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, colours = myPalette)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-22-1.png" alt=""></p>
<p>You can also combine the palettes. Let’s add another two palettes, usefull when particular ranges of values should be emphasized:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">myPalette &lt;- c(colorRampPalette(c(<span class="string">"black"</span>, <span class="string">"white"</span>))(<span class="number">100</span>), colorRampPalette(c(<span class="string">"red"</span>, <span class="string">"blue"</span>))(<span class="number">100</span>), colorRampPalette(c(<span class="string">"magenta"</span>, <span class="string">"orange"</span>))(<span class="number">100</span>))</div><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, colours = myPalette)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-23-1.png" alt=""></p>
<p>“Interesting” plots can be generated by shuffling the colours (not the use of rbind() instead of c(), also white has been replaced by green):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">myPalette &lt;- rbind(colorRampPalette(c(<span class="string">"black"</span>, <span class="string">"green"</span>))(<span class="number">100</span>), colorRampPalette(c(<span class="string">"green"</span>, <span class="string">"red"</span>))(<span class="number">100</span>), colorRampPalette(c(<span class="string">"red"</span>, <span class="string">"blue"</span>))(<span class="number">100</span>))</div><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, colours = myPalette)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-24-1.png" alt=""></p>
<h4 id="theme-ggplot-theme-to-be-used-default-internally-defined-theme"><a href="#theme-ggplot-theme-to-be-used-default-internally-defined-theme" class="headerlink" title="theme: ggplot theme to be used, default: internally defined theme"></a>theme: ggplot theme to be used, default: internally defined theme</h4><p>plotimggg.plot2D defines a reasonable black and white theme with some adjustments for fonts. You can supply your own theme instead. For exmple, to use the minimal theme set theme to theme_minimal():</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, theme = theme_minimal())</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-25-1.png" alt=""></p>
<p>More information can be obtained by reading the ggplot documentation. Or you can copy the definition of “mytheme” from the plotimggg.R and create your own custom theme.</p>
<h4 id="conv-kernel-image-convolution"><a href="#conv-kernel-image-convolution" class="headerlink" title="conv.kernel: image convolution"></a>conv.kernel: image convolution</h4><p>If we want to perform a simple convolution of the image with a Gaussian kernel we have to provide the kernel width (FWHM of the Gaussian) in the units in which axes are measured. In our examples the axes go from 1 to 11. The following command convolves the image shown in the previous example with a Gaussin kernel 0.6 units wide:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(x, y, img, zlog=<span class="literal">TRUE</span>, legend.direction = <span class="string">"vertical"</span>, conv.kernel = <span class="number">0.6</span>)</div></pre></td></tr></table></figure>
<pre><code>## [1] &quot;Convolving with sigma =  0.6  (pixels =  5.94 )&quot;
</code></pre><p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-26-1.png" alt=""></p>
<p>Note that the convolution is currently performed on the original 2D image array, and thus only makes sense when applied to Cartesian geometry. Hopefully in the future a more general convolution will be implemented.</p>
<h3 id="Spherical-coordinates"><a href="#Spherical-coordinates" class="headerlink" title="Spherical coordinates"></a>Spherical coordinates</h3><p>We can also provide the data in spherical coordinates. The routine creates an internal representation in the form of polygons and calls the ggplot geom_polygon() routines. This is slowe, but it provides reasonable results.</p>
<p>First, we create an array with spherical coordinates:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># define array dimensions</span></div><div class="line">snx &lt;- <span class="number">100</span></div><div class="line">sny &lt;- <span class="number">400</span></div><div class="line"></div><div class="line"><span class="comment"># axes limits</span></div><div class="line">sxlim = c(<span class="number">1e0</span>, <span class="number">2e0</span>)</div><div class="line">sylim = c(<span class="number">0e0</span>, <span class="number">2</span> * pi)</div><div class="line"></div><div class="line"><span class="comment"># compute axes</span></div><div class="line">sx &lt;- (<span class="number">0</span> : (snx - <span class="number">1</span>)) * (sxlim[<span class="number">2</span>] - sxlim[<span class="number">1</span>]) / snx + sxlim[<span class="number">1</span>]</div><div class="line">sy &lt;- (<span class="number">0</span> : (sny - <span class="number">1</span>)) * (sylim[<span class="number">2</span>] - sylim[<span class="number">1</span>]) / sny + sylim[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># declare array</span></div><div class="line">simg &lt;- array(<span class="number">1e0</span>, c(snx, sny))</div><div class="line"></div><div class="line"><span class="comment"># fill array with random numbers in a certain interval</span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:snx) &#123;</div><div class="line">    <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:sny) &#123;</div><div class="line">        simg[i, j] = (rnorm(<span class="number">1</span>, <span class="number">1e1</span>, <span class="number">0.3</span>))^<span class="number">2</span> * <span class="number">1e10</span> * (cos(sy[j])^<span class="number">2</span> + <span class="number">1e0</span>)/ (sx[i]^<span class="number">2</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we call the routine with the parameter igeom set to 2:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(sx, sy, simg, legend.direction = <span class="string">"vertical"</span>, igeom = <span class="number">2</span>, zlog=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-28-1.png" alt=""></p>
<p>We can also plot just a small wedge:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(sx, sy[<span class="number">250</span>:<span class="number">270</span>], simg[,<span class="number">250</span>:<span class="number">270</span>], legend.direction = <span class="string">"vertical"</span>, igeom = <span class="number">2</span>, zlog=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-29-1.png" alt=""> Or we can also plot everything but that small wedge:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pltimggg.plot2D(sx, sy[-(<span class="number">250</span>:<span class="number">270</span>)], simg[,-(<span class="number">250</span>:<span class="number">270</span>)], legend.direction = <span class="string">"vertical"</span>, igeom = <span class="number">2</span>, zlog=<span class="literal">TRUE</span>)</div></pre></td></tr></table></figure>
<p><img src="/pltimggg_files/figure-markdown_github/unnamed-chunk-30-1.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2016/12/01/Making-nice-2D-plots-using-ggplot-with-little-effort/" data-id="cj98cn4h4000574sroifk0hsf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/26/A-simple-status-progress-bar-with-time-estimator/">A simple status/progress bar with time estimator</a>
          </li>
        
          <li>
            <a href="/2017/08/13/A-simple-but-nontrivial-Shiny-App/">A simple (but nontrivial) Shiny App</a>
          </li>
        
          <li>
            <a href="/2017/08/08/R-versus-C-and-Fortran/">R versus C++ (and Fortran)</a>
          </li>
        
          <li>
            <a href="/2016/12/07/Making-nice-1D-plots-using-ggplot-with-little-effort/">Making nice 1D plots using ggplot with little effort</a>
          </li>
        
          <li>
            <a href="/2016/12/01/Avoid-unwanted-polygon-borders-in-ggplot/">Avoid unwanted polygon borders in ggplot</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Petar Mimica<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>