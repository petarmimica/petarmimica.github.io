<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>A simple (but nontrivial) Shiny App | Using R</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="IntroductionSome time ago I put it on my todo list to learn Shiny. I report my first non-trivial app, which is useful (for me at least), and also shows what can be done after even a few hours of work.">
<meta property="og:type" content="article">
<meta property="og:title" content="A simple (but nontrivial) Shiny App">
<meta property="og:url" content="http://petarmimica.github.io/2017/08/27/A-simple-but-nontrivial-Shiny-App/index.html">
<meta property="og:site_name" content="Using R">
<meta property="og:description" content="IntroductionSome time ago I put it on my todo list to learn Shiny. I report my first non-trivial app, which is useful (for me at least), and also shows what can be done after even a few hours of work.">
<meta property="og:locale" content="English">
<meta property="og:image" content="http://petarmimica.github.io/2017/08/27/A-simple-but-nontrivial-Shiny-App/shiny1.png">
<meta property="og:updated_time" content="2017-08-27T11:51:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A simple (but nontrivial) Shiny App">
<meta name="twitter:description" content="IntroductionSome time ago I put it on my todo list to learn Shiny. I report my first non-trivial app, which is useful (for me at least), and also shows what can be done after even a few hours of work.">
<meta name="twitter:image" content="http://petarmimica.github.io/2017/08/27/A-simple-but-nontrivial-Shiny-App/shiny1.png">
  
    <link rel="alternate" href="/atom.xml" title="Using R" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Using R</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">(for data analysis and visualization)</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://petarmimica.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-A-simple-but-nontrivial-Shiny-App" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/27/A-simple-but-nontrivial-Shiny-App/" class="article-date">
  <time datetime="2017-08-27T11:51:57.000Z" itemprop="datePublished">2017-08-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      A simple (but nontrivial) Shiny App
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Some time ago I put it on my todo list to learn <a href="https://shiny.rstudio.com/" target="_blank" rel="external">Shiny</a>. I report my first non-trivial app, which is useful (for me at least), and also shows what can be done after even a few hours of work.</p>
<p>The app can be accessed here: <a href="https://petarmimica.shinyapps.io/baby/" target="_blank" rel="external">https://petarmimica.shinyapps.io/baby/</a>.</p>
<h1 id="Shiny-apps"><a href="#Shiny-apps" class="headerlink" title="Shiny apps"></a>Shiny apps</h1><p>As discussed <a href="https://shiny.rstudio.com/articles/basics.html" target="_blank" rel="external">here</a> and ellaborated in much more detail in the rest of the <a href="https://shiny.rstudio.com/articles/" target="_blank" rel="external">documentation</a>, a Shiny app is a <a href="https://en.wikipedia.org/wiki/Web_application" target="_blank" rel="external">web application</a> written in Gnu R with help of the Shiny library. It has two basic parts:</p>
<ul>
<li>User interface (UI): an R source file that declares the UI elements, their layout and the functions that are executed on the server with the goal of displaying something or reacting to user actions.</li>
<li>Server: an R source file that implements various functions that are needed for the UI to work properly, as well as any other auxiliary functions.</li>
</ul>
<p>The Shiny library is very powerful in that it allows the programmer to program <a href="https://shiny.rstudio.com/articles/reactivity-overview.html" target="_blank" rel="external">reactively</a>. What this means in practice is that a (possibly computationally very expensive) operation is only executed if the user changes one or more of the input parameters on which that operation depends. For example, the plotting routine may only be called if the user has done something that requires it to be redrawn, while another part of the UI may contain a text that only changes when the user clicks on a plot (without that plot needing to be redrawn).</p>
<h1 id="What-I-did"><a href="#What-I-did" class="headerlink" title="What I did"></a>What I did</h1><p>I wanted to create an app that displays measurements of some babyâ€™s mass, height and head circumference. The app would let the user select what to display, and would perform a fit to a power-law dependence between the quantity and the number of days since birth. It would also allow the user to see what the model prediction for today is, as well as for another, user-specified date. It would also allow the user to change the date up to which the data is plotted. Finally, it would allow the user to click anywhere on a chart and get the values of that point.</p>
<p>Here is what the current version looks like: <img src="./shiny1.png" alt="Shiny1.app"></p>
<p>I have annotated the UI elements, as well as the points and curves on the chart.</p>
<h1 id="How-it-was-done"><a href="#How-it-was-done" class="headerlink" title="How it was done"></a>How it was done</h1><p>I hardcoded the data (there are only 6 points, so it was much easier to do). Then I did some processing on the data to make it easier to perform fits. The first Shiny related code concerns the definition of two global variables that contain the predictions for today and for user date:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reactively bound variables that store the user selected and today estimate</span></div><div class="line">user.y &lt;- <span class="literal">NULL</span></div><div class="line">today.y &lt;- <span class="literal">NULL</span></div></pre></td></tr></table></figure>
<p>Next comes the main server function:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># server function</span></div><div class="line">shinyServer(<span class="keyword">function</span>(input, output) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Before diving into it, let me introduce some user interface elements. I used the <a href="http://rstudio.github.io/shinydashboard/get_started.html" target="_blank" rel="external">shinydashoard</a> library to make it easier to organize the UI and to extend it in the future. The code for the full UI is surprisingly short:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">dashboardPage(</div><div class="line">  dashboardHeader(disable = <span class="literal">TRUE</span>),</div><div class="line">  dashboardSidebar(disable = <span class="literal">TRUE</span>),</div><div class="line">  </div><div class="line">  dashboardBody(</div><div class="line">    </div><div class="line">    <span class="comment"># Explanation</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="string">"Introduction"</span>,</div><div class="line">        htmlOutput(<span class="string">"intro"</span>)         </div><div class="line">    ),   </div><div class="line">    </div><div class="line">    <span class="comment"># Display chart</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="literal">NULL</span>,</div><div class="line">        plotOutput(<span class="string">"bioPlot"</span>, click = clickOpts(id =<span class="string">"chartClick"</span>))          </div><div class="line">    ),</div><div class="line">    </div><div class="line">    </div><div class="line">    fluidRow(</div><div class="line">      <span class="comment"># Variable selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          selectInput(<span class="string">"biometric"</span>, <span class="string">"Which biometric do you want to see?"</span>, list(<span class="string">"Body mass"</span> = <span class="string">"mass"</span>, <span class="string">"Height"</span> = <span class="string">"height"</span>, <span class="string">"Head circumference"</span> = <span class="string">"head"</span>))), </div><div class="line">      </div><div class="line">      <span class="comment"># User date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"query"</span>, <span class="string">"Which date are you interested in?"</span>)),</div><div class="line">      </div><div class="line">      <span class="comment"># Maximum date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"maxDate"</span>, <span class="string">"Up to which date do you wish to display?"</span>, value = <span class="string">"2018-01-31"</span>))</div><div class="line">      ),</div><div class="line">      </div><div class="line">    </div><div class="line">    <span class="comment"># Textual information boxes</span></div><div class="line">    fluidRow(</div><div class="line">      </div><div class="line">      <span class="comment"># Clicked point</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Values (click on the chart):"</span>,</div><div class="line">          textOutput(<span class="string">"chartInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for today</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estmate (today):"</span>,</div><div class="line">          textOutput(<span class="string">"todayInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for user selected date</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estimate (user selected date):"</span>,</div><div class="line">          textOutput(<span class="string">"userInfo"</span>))</div><div class="line">    )</div><div class="line">    </div><div class="line">  ) </div><div class="line">)</div></pre></td></tr></table></figure>
<p>Each element is encapsulated in the <code>box()</code> function, and sometimes the boxes are arranged in rows using the <code>fluidRow()</code> function. Inside the boxes there is a function that tells Shiny what kind of input or output is contained. For example, the introductory text is encapsulated inside <code>htmlOutput()</code>, while the pop-up menu for selecting the varibale goes inside <code>selectInput()</code>. The routines are pretty intuitive. The important thing to remember is that Shiny declares the <code>input</code> and <code>output</code> variables that are passed to the <code>shinyServer</code> function. Those variables are list whose elements are precisely the names passed to various input and output functions (e.g., <code>htmlOutput(&quot;intro&quot;)</code> causes an implementation of the <code>output$intro</code> function to be required inside <code>shinyServer</code>, while <code>dateInput(&quot;query&quot;)</code> causes a variable <code>input$query</code> to be defioned inside <code>shinyServer</code>).</p>
<p>My <code>shinyServer</code> starts by declaring those two variables, <code>user.y</code> and <code>today.y</code> as reactive:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># reactively bind user.y and today.y</span></div><div class="line">  makeReactiveBinding(<span class="string">"user.y"</span>)</div><div class="line">  makeReactiveBinding(<span class="string">"today.y"</span>)</div></pre></td></tr></table></figure>
<p>The implementation of the plotting routine follows this format:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># plot rendering routine</span></div><div class="line">  output$bioPlot &lt;- renderPlot(&#123;</div><div class="line">    </div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<p>Inside this functions there are several other functions. They all contain references to the elements of <code>input</code>. If any of those elements are changed, <code>output$bioPlot</code> gets called. This is done internally by Shiny and I do not need to worry about it. For example, I declared three functions that help me generate the correct variable name and its corresponding physical unit:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># select the correct current data frame</span></div><div class="line">    dfSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = mass.df, <span class="string">"height"</span> = height.df, <span class="string">"head"</span> = head.df)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct unit</span></div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct variable name including unit</span></div><div class="line">    varSelect &lt;- reactive(&#123;</div><div class="line">      paste(input$biometric, <span class="string">" ["</span>, unitSelect(), <span class="string">"]"</span>, sep = <span class="string">""</span>)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>Note the <code>reactive</code> keyword, which is what Shiny uses to determine the dependencies. The fitting routine is also reactive and it returns a list with predictions and also with the fit coefficients:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># fit the to the currently active data frame</span></div><div class="line">    currentFit &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># power-law fit: log(y) = A0 + A1 * log(x) &lt;-&gt; y = A0 * x^A1</span></div><div class="line">      fit &lt;- nls(ly ~ A0 + A1 * lx, data = dfSelect(), start=list(A0 = <span class="number">3.2</span>, A1 = <span class="number">0.0</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit parameters</span></div><div class="line">      coefs &lt;- fit$m$getPars()</div><div class="line">      </div><div class="line">      <span class="comment"># compute x values for predictions (using user selectable maxDate)</span></div><div class="line">      pred &lt;- data.frame(x = <span class="number">1</span>:(as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))))</div><div class="line">      <span class="comment"># compute the predicted y value</span></div><div class="line">      pred &lt;- pred %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      </div><div class="line">      <span class="comment"># return list with predictions and coefficients</span></div><div class="line">      list(pred=pred, coefs=coefs)</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>To compute the predictions for today and for a user selected date I do the following:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compute the user date prediction (shown as horizontal line)</span></div><div class="line">   userData &lt;- reactive(&#123;</div><div class="line">     </div><div class="line">     <span class="comment"># create a small data frame with two points</span></div><div class="line">     user.df &lt;- data.frame(x=rep(as.numeric(ymd(input$query) - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">     </div><div class="line">     <span class="comment"># get fit coefficients</span></div><div class="line">     coefs &lt;- currentFit()$coefs</div><div class="line">     </div><div class="line">     <span class="comment"># compute the corresponding y values</span></div><div class="line">     user.df &lt;- user.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">     user.y &lt;&lt;- user.df$y[<span class="number">1</span>]</div><div class="line">     user.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">   &#125;)</div><div class="line">   </div><div class="line">   <span class="comment"># compute today's prediction (shown as horizontal line)</span></div><div class="line">   todayData &lt;- reactive(&#123;</div><div class="line">     </div><div class="line">     <span class="comment"># create a small data frame with two points</span></div><div class="line">     today.df &lt;- data.frame(x=rep(as.numeric(today() - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">     </div><div class="line">     <span class="comment"># get fit coefficients</span></div><div class="line">     coefs &lt;- currentFit()$coefs</div><div class="line">     </div><div class="line">     <span class="comment"># compute the corresponding y values</span></div><div class="line">     today.df &lt;- today.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">     today.y &lt;&lt;- today.df$y[<span class="number">1</span>]</div><div class="line">     today.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">   &#125;)</div></pre></td></tr></table></figure>
<p>Note that in these routines the variables <code>user.y</code> and <code>today.y</code> are set. This is done to avoid having to recompute unnecessarily them when they are used by the output routines:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># display today's info</span></div><div class="line">output$todayInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (!is.null(today.y)) &#123;</div><div class="line">    y &lt;- today.y</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, today(), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment"># display user selected date info</span></div><div class="line">output$userInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (!is.null(user.y)) &#123;</div><div class="line">    y &lt;- user.y</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, input$query, <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Note that these routines only return a non-null result if the variables <code>today.y</code> and <code>user.y</code> are themselves non-null. This is to avoid any problems with initializing the user interface. The true power of reactive programming is shown here, because <code>output$userInfo</code> does not need to recompute the <code>user.y</code> if e.g., <code>input$query</code> changes, becuase <code>userData</code> function inside <code>output$bioPlot</code> will be called anyway and it will compute the new value.</p>
<p>The rest of the plotting routine concerns itself with computing the minimum and maximum y values inside the range requested by the user (i.e., <code>input$maxDate</code> is a reactive variable used here):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compute the y limits based on the user selectable date range</span></div><div class="line">    </div><div class="line">    <span class="comment"># store predictions in preds</span></div><div class="line">    preds &lt;- currentFit()$pred</div><div class="line">    </div><div class="line">    <span class="comment"># compute the maximum number of days to be shown</span></div><div class="line">    max.days &lt;- as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))</div><div class="line">    </div><div class="line">    <span class="comment"># compute y range</span></div><div class="line">    y.min &lt;- min(preds$y[preds$x &lt;= max.days])</div><div class="line">    y.max &lt;- max(preds$y[preds$x &lt;= max.days])</div><div class="line">    </div><div class="line">    ud &lt;- userData()</div><div class="line">    td &lt;- todayData()</div><div class="line">    </div><div class="line">    <span class="comment"># plot</span></div><div class="line">   ggplot(<span class="literal">NULL</span>) +<span class="comment"># plot multiple data frames, so start with null</span></div><div class="line">   mytheme +<span class="comment"># add the theme</span></div><div class="line">   geom_point(data = dfSelect(), aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) +<span class="comment"># plot measurements</span></div><div class="line">     geom_line(data = preds, aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) + <span class="comment"># plot predictions</span></div><div class="line">   scale_x_date(limits = ymd(c(<span class="string">"2017-01-31"</span>), input$maxDate)) + scale_y_continuous(limits = c(y.min, y.max)) + <span class="comment"># set x and y limits</span></div><div class="line">     xlab(<span class="string">"date"</span>) + ylab(varSelect()) <span class="comment"># axis labels</span></div></pre></td></tr></table></figure>
<p>The function <code>output$chartInfo</code> shows the values at the position where the user last clicked inside the graph. It is connected to the plot via the <code>clickOpts</code> keyword in the UI definition: <code>plotOutput(&quot;bioPlot&quot;, click = clickOpts(id =&quot;chartClick&quot;))</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># display click info</span></div><div class="line">output$chartInfo &lt;- renderPrint(&#123;</div><div class="line">  </div><div class="line">  unitSelect &lt;- reactive(&#123;</div><div class="line">    <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(!is.null(input$chartClick))&#123;</div><div class="line">    cat(paste(<span class="string">"Date: "</span>, as.Date(input$chartClick$x - <span class="number">17197</span>, origin=ymd(<span class="string">"2017-01-31"</span>)), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(input$chartClick$y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>Note how the UI and server are easily connected using labels passed to the UI definition functions.</p>
<h1 id="The-full-code-except-for-data"><a href="#The-full-code-except-for-data" class="headerlink" title="The full code (except for data)"></a>The full code (except for data)</h1><p>This Shiny app has two source files, but it could also have been written in a single file. The UI definition is in the <code>ui.R</code> file:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># User interface code</span></div><div class="line"><span class="comment"># Author: Petar Mimica &lt;petar.mimica@gmail.com&gt;, August 2017</span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(shiny)</div><div class="line"><span class="keyword">library</span>(shinydashboard)</div><div class="line"></div><div class="line"></div><div class="line">dashboardPage(</div><div class="line">  dashboardHeader(disable = <span class="literal">TRUE</span>),</div><div class="line">  dashboardSidebar(disable = <span class="literal">TRUE</span>),</div><div class="line">  </div><div class="line">  dashboardBody(</div><div class="line">    </div><div class="line">    <span class="comment"># Explanation</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="string">"Introduction"</span>,</div><div class="line">        htmlOutput(<span class="string">"intro"</span>)         </div><div class="line">    ),   </div><div class="line">    </div><div class="line">    <span class="comment"># Display chart</span></div><div class="line">    box(width = <span class="number">12</span>, title = <span class="literal">NULL</span>,</div><div class="line">        plotOutput(<span class="string">"bioPlot"</span>, click = clickOpts(id =<span class="string">"chartClick"</span>))          </div><div class="line">    ),</div><div class="line">    </div><div class="line">    </div><div class="line">    fluidRow(</div><div class="line">      <span class="comment"># Variable selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          selectInput(<span class="string">"biometric"</span>, <span class="string">"Which biometric do you want to see?"</span>, list(<span class="string">"Body mass"</span> = <span class="string">"mass"</span>, <span class="string">"Height"</span> = <span class="string">"height"</span>, <span class="string">"Head circumference"</span> = <span class="string">"head"</span>))), </div><div class="line">      </div><div class="line">      <span class="comment"># User date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"query"</span>, <span class="string">"Which date are you interested in?"</span>)),</div><div class="line">      </div><div class="line">      <span class="comment"># Maximum date selector</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="literal">NULL</span>, </div><div class="line">          dateInput(<span class="string">"maxDate"</span>, <span class="string">"Up to which date do you wish to display?"</span>, value = <span class="string">"2018-01-31"</span>))</div><div class="line">      ),</div><div class="line">      </div><div class="line">    </div><div class="line">    <span class="comment"># Textual information boxes</span></div><div class="line">    fluidRow(</div><div class="line">      </div><div class="line">      <span class="comment"># Clicked point</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Values (click on the chart):"</span>,</div><div class="line">          textOutput(<span class="string">"chartInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for today</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estmate (today):"</span>,</div><div class="line">          textOutput(<span class="string">"todayInfo"</span>)), </div><div class="line">      </div><div class="line">      <span class="comment"># Estimate for user selected date</span></div><div class="line">      box(width = <span class="number">4</span>, title = <span class="string">"Estimate (user selected date):"</span>,</div><div class="line">          textOutput(<span class="string">"userInfo"</span>))</div><div class="line">    )</div><div class="line">    </div><div class="line">  ) </div><div class="line">)</div></pre></td></tr></table></figure>
<p>The server is in <code>server.R</code>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Server code</span></div><div class="line"><span class="comment"># Author: Petar Mimica &lt;petar.mimica@gmail.com&gt;, August 2017</span></div><div class="line"></div><div class="line"><span class="comment"># Load libraries</span></div><div class="line"><span class="keyword">library</span>(shiny)</div><div class="line"><span class="keyword">library</span>(lubridate)</div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"><span class="keyword">library</span>(tidyr)</div><div class="line"><span class="keyword">library</span>(dplyr)</div><div class="line"></div><div class="line"><span class="comment"># Define a ggplot theme</span></div><div class="line">mytheme &lt;- theme_bw() + theme(axis.text=element_text(size=<span class="number">14</span>))+theme(axis.title=element_text(size=<span class="number">14</span>))+theme(axis.line=element_line(size=<span class="number">2</span>))+theme(legend.text=element_text(size=<span class="number">12</span>))+theme(legend.title=element_text(size=<span class="number">14</span>))+theme(legend.key = element_blank(), legend.key.width = unit(<span class="number">18</span>, <span class="string">"points"</span>))</div><div class="line"></div><div class="line"><span class="comment"># Define the data frames (*** fill in your own data***)</span></div><div class="line">mass.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">3000</span>, <span class="number">3001</span>))</div><div class="line">height.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">50</span>, <span class="number">51</span>))</div><div class="line">head.df &lt;- data.frame(x=ymd(c(<span class="string">"2017-01-01"</span>, <span class="string">"2017-01-02"</span>), y=c(<span class="number">32</span>, <span class="number">33</span>))</div><div class="line"></div><div class="line"><span class="comment"># Process the data frames</span></div><div class="line">mass.df &lt;- mass.df %&gt;% mutate(y = y / <span class="number">1e3</span>, x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line">height.df &lt;- height.df %&gt;% mutate(x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line">head.df &lt;- head.df %&gt;% mutate(x = as.numeric(x- ymd(<span class="string">"2017-01-31"</span>)), ly = log(y), lx = log(x))</div><div class="line"></div><div class="line"><span class="comment"># Reactively bound variables that store the user selected and today estimate</span></div><div class="line">user.y &lt;- <span class="literal">NULL</span></div><div class="line">today.y &lt;- <span class="literal">NULL</span></div><div class="line"></div><div class="line"><span class="comment"># server function</span></div><div class="line">shinyServer(<span class="keyword">function</span>(input, output) &#123;</div><div class="line">  </div><div class="line">  <span class="comment"># reactively bind user.y and today.y</span></div><div class="line">  makeReactiveBinding(<span class="string">"user.y"</span>)</div><div class="line">  makeReactiveBinding(<span class="string">"today.y"</span>)</div><div class="line">  </div><div class="line">  <span class="comment"># plot rendering routine</span></div><div class="line">  output$bioPlot &lt;- renderPlot(&#123;</div><div class="line">    </div><div class="line">    <span class="comment"># select the correct current data frame</span></div><div class="line">    dfSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = mass.df, <span class="string">"height"</span> = height.df, <span class="string">"head"</span> = head.df)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct unit</span></div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the correct variable name including unit</span></div><div class="line">    varSelect &lt;- reactive(&#123;</div><div class="line">      paste(input$biometric, <span class="string">" ["</span>, unitSelect(), <span class="string">"]"</span>, sep = <span class="string">""</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment"># fit the to the currently active data frame</span></div><div class="line">    currentFit &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># power-law fit: log(y) = A0 + A1 * log(x) &lt;-&gt; y = A0 * x^A1</span></div><div class="line">      fit &lt;- nls(ly ~ A0 + A1 * lx, data = dfSelect(), start=list(A0 = <span class="number">3.2</span>, A1 = <span class="number">0.0</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit parameters</span></div><div class="line">      coefs &lt;- fit$m$getPars()</div><div class="line">      </div><div class="line">      <span class="comment"># compute x values for predictions (using user selectable maxDate)</span></div><div class="line">      pred &lt;- data.frame(x = <span class="number">1</span>:(as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))))</div><div class="line">      <span class="comment"># compute the predicted y value</span></div><div class="line">      pred &lt;- pred %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      </div><div class="line">      <span class="comment"># return list with predictions and coefficients</span></div><div class="line">      list(pred=pred, coefs=coefs)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute the user date prediction (shown as horizontal line)</span></div><div class="line">    userData &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># create a small data frame with two points</span></div><div class="line">      user.df &lt;- data.frame(x=rep(as.numeric(ymd(input$query) - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit coefficients</span></div><div class="line">      coefs &lt;- currentFit()$coefs</div><div class="line">      </div><div class="line">      <span class="comment"># compute the corresponding y values</span></div><div class="line">      user.df &lt;- user.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      user.y &lt;&lt;- user.df$y[<span class="number">1</span>]</div><div class="line">      user.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># compute today's prediction (shown as horizontal line)</span></div><div class="line">    todayData &lt;- reactive(&#123;</div><div class="line">      </div><div class="line">      <span class="comment"># create a small data frame with two points</span></div><div class="line">      today.df &lt;- data.frame(x=rep(as.numeric(today() - ymd(<span class="string">"2017-01-31"</span>)), <span class="number">2</span>))</div><div class="line">      </div><div class="line">      <span class="comment"># get fit coefficients</span></div><div class="line">      coefs &lt;- currentFit()$coefs</div><div class="line">      </div><div class="line">      <span class="comment"># compute the corresponding y values</span></div><div class="line">      today.df &lt;- today.df %&gt;% mutate(lx = log(x), ly = coefs[<span class="number">1</span>] + coefs[<span class="number">2</span>] * lx, y = exp(ly))</div><div class="line">      today.y &lt;&lt;- today.df$y[<span class="number">1</span>]</div><div class="line">      today.df %&gt;% mutate(x = c(<span class="number">1</span>, (as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>)))))</div><div class="line">    &#125;)  </div><div class="line">    </div><div class="line">    <span class="comment"># compute the y limits based on the user selectable date range</span></div><div class="line">    </div><div class="line">    <span class="comment"># store predictions in preds</span></div><div class="line">    preds &lt;- currentFit()$pred</div><div class="line">    </div><div class="line">    <span class="comment"># compute the maximum number of days to be shown</span></div><div class="line">    max.days &lt;- as.numeric(input$maxDate - ymd(<span class="string">"2017-01-31"</span>))</div><div class="line">    </div><div class="line">    <span class="comment"># compute y range</span></div><div class="line">    y.min &lt;- min(preds$y[preds$x &lt;= max.days])</div><div class="line">    y.max &lt;- max(preds$y[preds$x &lt;= max.days])</div><div class="line">    </div><div class="line">    ud &lt;- userData()</div><div class="line">    td &lt;- todayData()</div><div class="line">    </div><div class="line">    <span class="comment"># plot</span></div><div class="line">    ggplot(<span class="literal">NULL</span>) +<span class="comment"># plot multiple data frames, so start with null</span></div><div class="line">      mytheme +<span class="comment"># add the theme</span></div><div class="line">      geom_point(data = dfSelect(), aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) +<span class="comment"># plot measurements</span></div><div class="line">      geom_line(data = preds, aes(x = x + ymd(<span class="string">"2017-01-31"</span>), y = y)) + <span class="comment"># plot predictions</span></div><div class="line">      scale_x_date(limits = ymd(c(<span class="string">"2017-01-31"</span>), input$maxDate)) + scale_y_continuous(limits = c(y.min, y.max)) + <span class="comment"># set x and y limits</span></div><div class="line">      xlab(<span class="string">"date"</span>) + ylab(varSelect()) <span class="comment"># axis labels</span></div><div class="line">    </div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="comment"># display click info</span></div><div class="line">  output$chartInfo &lt;- renderPrint(&#123;</div><div class="line">    </div><div class="line">    unitSelect &lt;- reactive(&#123;</div><div class="line">      <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(!is.null(input$chartClick))&#123;</div><div class="line">      cat(paste(<span class="string">"Date: "</span>, as.Date(input$chartClick$x - <span class="number">17197</span>, origin=ymd(<span class="string">"2017-01-31"</span>)), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(input$chartClick$y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment"># display today's info</span></div><div class="line">    output$todayInfo &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      unitSelect &lt;- reactive(&#123;</div><div class="line">        <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">      &#125;)</div><div class="line">      </div><div class="line">      <span class="keyword">if</span> (!is.null(today.y)) &#123;</div><div class="line">        y &lt;- today.y</div><div class="line">        cat(paste(<span class="string">"Date: "</span>, today(), <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># display user selected date info</span></div><div class="line">    output$userInfo &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      unitSelect &lt;- reactive(&#123;</div><div class="line">        <span class="keyword">switch</span>(input$biometric, <span class="string">"mass"</span> = <span class="string">"kg"</span>, <span class="string">"height"</span> = <span class="string">"cm"</span>, <span class="string">"head"</span> = <span class="string">"cm"</span>)</div><div class="line">      &#125;)</div><div class="line">      </div><div class="line">      <span class="keyword">if</span> (!is.null(user.y)) &#123;</div><div class="line">        y &lt;- user.y</div><div class="line">        cat(paste(<span class="string">"Date: "</span>, input$query, <span class="string">", "</span>, input$biometric, <span class="string">": "</span>, formatC(y, digits=<span class="number">1</span>, format=<span class="string">"f"</span>), <span class="string">" "</span>, unitSelect(), sep = <span class="string">""</span>))</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    </div><div class="line">    <span class="comment"># introductory text</span></div><div class="line">    output$intro &lt;- renderPrint(&#123;</div><div class="line">      </div><div class="line">      cat(<span class="string">"This is an example of a Shiny app that displays a chart of three different datasets and uses a power-law fit (y = a*x^b) to model the data. The user can select which data to show, and can also obtain information about predictions for today and for a user selecte date. Clicking on a chart shows the values at the point clicked. More information can be found &lt;a href='http://www.uv.es/mimica/Rblog/shiny1.html'&gt;on my blog&lt;/a&gt;."</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">&#125;)</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://petarmimica.github.io/2017/08/27/A-simple-but-nontrivial-Shiny-App/" data-id="cj6uohflz0000e7rn78qid69a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/08/23/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/27/A-simple-but-nontrivial-Shiny-App/">A simple (but nontrivial) Shiny App</a>
          </li>
        
          <li>
            <a href="/2017/08/23/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Petar Mimica<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>